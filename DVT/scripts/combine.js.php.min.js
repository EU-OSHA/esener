
var primaryVisualizationUpto = 4;
var plotsParameters = new Array("heatMap", new Array("subset", "subsetValue", "answer", "onlyEU"), "inCountry", new Array("subset", "country"), "crossCountry", new Array("subset", "subsetValue", "country", "countryB"), "euBars", new Array("subset", "subsetValue", "onlyEU"), "maskMap", new Array(), "euMatrix", new Array("onlyEU"), "wordMap", new Array("subset", "subsetValue", "answer"), "euCompass", new Array("subset", "subsetValue", "answer"), "subsetTimeSeries", new Array("subset", "answer", "country"));
var plotFilesParameters = new Array("heatMap", new Array("dataSource", "subset", "subsetValue", "question", "answer", "locale", "onlyEU"), "wordMap", new Array("dataSource", "subset", "subsetValue", "question", "answer", "locale"), "euCompass", new Array("dataSource", "subset", "subsetValue", "question", "answer", "locale"), "euBars", new Array("dataSource", "subset", "subsetValue", "question", "locale", "onlyEU"), "inCountry", new Array("dataSource", "subset", "question", "country", "locale"), "crossCountry", new Array("dataSource", "subset", "subsetValue", "question", "country", "countryB", "locale"), "euMatrix", new Array("dataSource", "question", "locale", "onlyEU"), "subsetTimeSeries", new Array("dataSource", "subset", "question", "answer", "country", "locale"));
var allParameters = new Array("subset", "subsetValue", "answer", "country", "countryB", "onlyEU");
var commonParameters = new Array("dataSource", "question");
var elementsOnQuestionUpdate = "#title_question";
var server = "";

function updateVisualization() {
	
	var surveyid = $("#dataSource").val();
	
	
    updateQuestionChangeDependentElements();
	$(".proxy_plot_leftlabel7").addClass ("hidden");
    updateVisualizationDepedencies();
    swapVisualizationData();
    $("#csvView").attr("checked", false);
    resetCSViewer();
    $visualizationFilters = $(".visualizationFilters");
	//RRL 09/04/2015 Disable the previostquest if we are in the first question and the next question if you are in the last of them****************
	//$("#country option:selected").text(#country option:selected".val());
	
	$questions = $("#question")[0];
    questionIndex = $questions.selectedIndex;
	questionsLength = $questions.length;
	
	$(".menuactive").each(function(){
		$(this).removeClass("menuactive");
	});
	
	if (questionIndex == 1){
		$("a[class='prevQuest']").addClass("hidden");
		$("a[id='prevQuest']").addClass("hidden");
	}
	else
	{	
		$("a[class='prevQuest hidden']").removeClass("hidden");
		$("a[id='prevQuest']").removeClass("hidden");
	}
	
	if (questionIndex == questionsLength - 1){
		$("a[class='nextQuest']").addClass("hidden");
		$("a[id='nextQuest']").addClass("hidden");
	}
	else
	{
		$("a[class='nextQuest hidden']").removeClass("hidden");
		$("a[id='nextQuest']").removeClass("hidden");
	}
	//***********************************************************************************************************************************************
	
	//RRL 08/04/15************************************************************
	lenlocale = $("#locale option:selected").val();
	$(".buttomlan").removeClass("lenSel");
	$(".buttomlan[rel="+lenlocale+"]").addClass("lenSel");  
	
	questionid = $("#question option:selected").val();
	alertnotdis = $("#alertnotdis").text();
	//Select the menu option for this question
	$("a[for='"+questionid+"']").parent().addClass("menuactive");
	$(".visualizationDynamicDescription").hide();
	
	//Activate the filters that could be hidden for the distinct rules
	$("option[value='Sectorgrp']").show();
	$("option[value='3--50-249']").show();
	$("option[value='4--250-']").show();
	$("option[value='6--O']").show();
	
	
	//Countrys with no data for some questions*************************************************************************************************
	if (questionid=='Q166_1' && $("#plot").val() == 'inCountry'){
	
		$("li[data-option-array-index=3]").hide();
		$("li[data-option-array-index=6]").hide();
		$("li[data-option-array-index=10]").hide();
		$("li[data-option-array-index=24]").hide();
		$("li[data-option-array-index=32]").hide();
			
	}
	
	
	
	//*************************************************************************************************
	
	//RULE5*******************************************************************************************
	if (questionid=='Q261_1'|| questionid=='Q261_2'|| questionid=='Q261_3'|| questionid=='Q261_4'){
		$("option[value='Sectorgrp']").hide();
		//jQuery("#subset option:eq(1)").attr("selected","selected");
		$ ("option[value='Size']").attr("selected","selected");
		if (($("#plot").val()) == 'heatMap' || ($("#plot").val()) == 'euBars' ||($("#plot").val()) == 'crossCountry'){
			var myOpts = document.getElementById('subsetValue').options; 
			$("option[value='4--250-']").hide();
			
			if (myOpts[1].value == '1--A')
				initLinkedSelect($("#subset")[0], $("#subsetValue")[0], subset_subsetValue);
				
		}
		
		if (($("#plot").val()) == 'heatMap' || ($("#plot").val()) == 'euBars'){
			$("option[value='3--50-249']").hide();
		}
		
		//Rule 5 point 4
		if (($("#plot").val()) == 'crossCountry'){
			c1 =  $("#country option:selected").val();
			c2 =  $("#countryB option:selected").val();
			sv = $("#subsetValue option:selected").val();
	
			if (sv == '3--50-249'){
				if (c1=="AL" || c2 == "AL" || c1=="ME" || c2 == "ME"|| c1=="BG" || c2 == "BG"|| c1=="DK" || c2 == "DK"|| 
				c1=="EE" || c2 == "EE"|| c1=="ES" || c2 == "ES"|| c1=="HR" || c2 == "HR" || c1=="IT" || c2 == "IT" || c1=="LV" || c2 == "LV"
				|| c1=="RO" || c2 == "RO"|| c1=="SE" || c2 == "SE"|| c1=="SI" || c2 == "SI"|| c1=="UK" || c2 == "UK"){
					alert(alertnotdis);
					jQuery("#subsetValue option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
		}
		
		//Rule 5 point 5
		if (($("#plot").val()) == 'inCountry'){
			$("ul.visualisationSelections li:eq(0)").addClass("selected");
			alert(alertnotdis);
			$("a[proxyplot=heatMap]").click(); 
			$("ul.visualisationSelections li:eq(0)").addClass("selected");
			return false;
		}
	
	}
	//RULE 5 END***************************************************************************************
	
	//RULE2 START**************************************************************************************
	if (questionid=='Q202_2'|| questionid=='Q202_3'|| questionid=='Q202_5'|| questionid=='Q202_6' || questionid=='Q202_8' || questionid=='Q202_9'
	|| questionid=='Q202_11' || questionid=='Q202_12' || questionid=='Q202_13' || questionid=='Q202_15' || questionid=='Q251' || questionid=='Q252_1'
	|| questionid=='Q252_2' || questionid=='Q252_3' || questionid=='Q252_4' || questionid=='Q252_5' || questionid=='Q252_6' || questionid=='Q254gr'
	|| questionid=='Q255' || questionid=='Q256_1' || questionid=='Q256_2' || questionid=='Q256_3' || questionid=='Q256_4' || questionid=='Q256_5' 
	|| questionid=='Q258b' || questionid=='Q259' || questionid=='Q308_1' || questionid=='Q354'){
		
		if (($("#plot").val()) == 'heatMap' || ($("#plot").val()) == 'euBars'){
			//alert($("#subsetValue option:selected").val());
			if ($("#subsetValue option:selected").val()=='6--O'){
				$("#subsetValue option:eq(0)").attr("selected","selected");
				window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm")) 
			}
			$("option[value='6--O']").hide();
		}
	}
	//RULE2 END****************************************************************************************
	
	
	
	if (questionid=='Q300'|| questionid=='Q301'|| questionid=='Q302'){
		$("option[value='1--A']").addClass("hidden");
		$("option[value='1--5-to-9']").addClass("hidden");
		
		if (($("#plot").val()) == 'inCountry'){
			$("ul.visualisationSelections li:eq(0)").addClass("selected");
			alert(alertnotdis);
			$("a[proxyplot=heatMap]").click(); 
			$("ul.visualisationSelections li:eq(0)").addClass("selected");
			return false;
		}
	}else{
		$("option[value='1--A']").removeClass("hidden");
		$("option[value='1--5-to-9']").removeClass("hidden");
	}
	
	
	//For all question less Q261_1 - Q261_4
	//RULE 1 START***************************************************************************************
	if (questionid!='Q261_1' && questionid!='Q261_2' && questionid!='Q261_3' && questionid!='Q261_4' && surveyid == 'esener04'){
		if (($("#plot").val()) == 'heatMap' || ($("#plot").val()) == 'euBars'){
			$("option[value='1--A']").addClass("hidden");
		}
	
		if (($("#plot").val()) == 'crossCountry'){
			c1 =  $("#country option:selected").val();
			c2 =  $("#countryB option:selected").val();
			sv = $("#subsetValue option:selected").val();
	
			if (sv == '1--A'){
				if (c1=="AL" || c2 == "AL" || c1=="AT" || c2 == "AT" || c1=="BE" || c2 == "BE"|| c1=="CH" || c2 == "CH"|| 
				c1=="CY" || c2 == "CY"|| c1=="HR" || c2 == "HR"|| c1=="IE" || c2 == "IE"|| c1=="LT" || c2 == "LT"|| 
				c1=="LU" || c2 == "LU"|| c1=="ME" || c2 == "ME"|| c1=="MK" || c2 == "MK"|| c1=="MT" || c2 == "MT"|| 
				c1=="NO" || c2 == "NO"|| c1=="RS" || c2 == "RS"|| c1=="SE" || c2 == "SE"){
					alert(alertnotdis);
					jQuery("#subsetValue option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
		}
	
		if(($("#plot").val()) == 'inCountry' && surveyid == 'esener04'){
			By = $("#subset option:selected").val();
			if (By == "Sectorgrp"){
				removeCountrys();
				$("li[data-option-array-index=3]").addClass("result-selected");
				//If one of the countrys we dont want is selected then we select the first country with data (Bulgaria)
				if($("#country option:eq(0)").attr("selected")
					|| $("#country option:eq(1)").attr("selected")
					|| $("#country option:eq(2)").attr("selected")
					|| $("#country option:eq(4)").attr("selected")
					|| $("#country option:eq(5)").attr("selected")
					|| $("#country option:eq(14)").attr("selected")
					|| $("#country option:eq(16)").attr("selected")
					|| $("#country option:eq(19)").attr("selected")
					|| $("#country option:eq(20)").attr("selected")
					|| $("#country option:eq(22)").attr("selected")
					|| $("#country option:eq(23)").attr("selected")
					|| $("#country option:eq(24)").attr("selected")
					|| $("#country option:eq(26)").attr("selected")
					|| $("#country option:eq(30)").attr("selected")
					|| $("#country option:eq(31)").attr("selected")
				){ 
					$("#country option:eq(3)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(3)").text());
					//window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
				}
			}
		}
		// Countrys withoutdata for some questions***********
		if(($("#plot").val()) == 'inCountry'){
			
			if (questionid=='Q166_1'){	
				removeCountrys2();
				if ($("#country option:eq(3)").attr("selected")
					|| $("#country option:eq(5)").attr("selected")
					|| $("#country option:eq(9)").attr("selected")
					|| $("#country option:eq(23)").attr("selected")
					|| $("#country option:eq(31)").attr("selected")
				){
					$("#country option:eq(6)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(6)").text());	
				}
			
			}	
			
			if (questionid=='Q166_2'){	
				removeCountrys2();
				if ($("#country option:eq(1)").attr("selected")
					|| $("#country option:eq(7)").attr("selected")
					|| $("#country option:eq(20)").attr("selected")
				){
					$("#country option:eq(3)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(3)").text());	
				}
			}	
			
			if (questionid=='Q166_4'){	
				removeCountrys2();
				if ($("#country option:eq(23)").attr("selected")
					|| $("#country option:eq(32)").attr("selected")
				){
					$("#country option:eq(3)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(3)").text());	
				}
			}
			
			if (questionid=='Q256_3'){	
				removeCountrys2();
				if ($("#country option:eq(3)").attr("selected")
					|| $("#country option:eq(5)").attr("selected")
					|| $("#country option:eq(9)").attr("selected")
					|| $("#country option:eq(23)").attr("selected")
					|| $("#country option:eq(31)").attr("selected")
				){
					$("#country option:eq(6)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(6)").text());	
				}
			
			}	
			
			if (questionid=='Q256_4'){	
				removeCountrys2();
				if ($("#country option:eq(1)").attr("selected")
					|| $("#country option:eq(7)").attr("selected")
					|| $("#country option:eq(20)").attr("selected")
				){
					$("#country option:eq(3)").attr("selected","selected");
					$("#country_chosen .chosen-single span").text($("#country option:eq(3)").text());	
				}
			}
		}
		
		// Conuntrys withoutdata for some questions***********
		if (($("#plot").val()) == 'crossCountry'){
			c1 =  $("#country option:selected").val();
			c2 =  $("#countryB option:selected").val();
			sv = $("#subsetValue option:selected").val();
	
			if (questionid=='Q166_1'){
				if (c1=="CY" || c2 == "CY"|| c1=="MK" || c2 == "MK"||  c1=="SE" || c2 == "SE" || c1=="EE" || c2 == "EE" || c1=="BG" || c2 == "BG"){
					alert(alertnotdis);
					jQuery("#country option:eq(6)").attr("selected","selected");	
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
			
			if (questionid=='Q166_2'){
				if (c1=="AT" || c2 == "AT"|| c1=="DE" || c2 == "DE"|| c1=="LU" || c2 == "LU"){
					alert(alertnotdis);
					jQuery("#country option:eq(3)").attr("selected","selected");	
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
			
			if (questionid=='Q166_4'){
				if (c1=="MK" || c2 == "MK"|| c1=="SI" || c2 == "SI"){
					alert(alertnotdis);
					jQuery("#country option:eq(3)").attr("selected","selected");	
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
			
			if (questionid=='Q256_3'){

				if (c1=="CY" || c2 == "CY"|| c1=="MK" || c2 == "MK"||  c1=="SE" || c2 == "SE" || c1=="EE" || c2 == "EE" || c1=="BG" || c2 == "BG"){
					alert(alertnotdis);
					jQuery("#country option:eq(6)").attr("selected","selected");	
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
			
			if (questionid=='Q256_4'){
				if (c1=="AT" || c2 == "AT"|| c1=="DE" || c2 == "DE" || c1=="LU" || c2 == "LU"){
					alert(alertnotdis);
					jQuery("#country option:eq(3)").attr("selected","selected");	
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
					return false;
				}
			}
		
		}
		
		
		
		
		
	}	
	//RULE 1 END*****************************************************************************************
	//Exceptions for ESENER1
	if(($("#plot").val()) == 'inCountry'){
		if (questionid=='MM303a'){	
			removeCountrys2();
			if ($("#country option:eq(4)").attr("selected")
				|| $("#country option:eq(8)").attr("selected")
				|| $("#country option:eq(20)").attr("selected")
			){
				$("#country option:eq(0)").attr("selected","selected");
				$("#country_chosen .chosen-single span").text($("#country option:eq(0)").text());	
			}
		}	
		
		if (questionid=='MM350'){	
			removeCountrys2();
			if ($("#country option:eq(4)").attr("selected")
				|| $("#country option:eq(20)").attr("selected")
				|| $("#country option:eq(26)").attr("selected")
			){
				$("#country option:eq(0)").attr("selected","selected");
				$("#country_chosen .chosen-single span").text($("#country option:eq(0)").text());	
			}
		}	
		
		if (questionid=='MM351'){	
			removeCountrys2();
			
			if ($("#country option:eq(0)").attr("selected")
				|| $("#country option:eq(6)").attr("selected")
				|| $("#country option:eq(18)").attr("selected")
			){
				$("#country_chosen a span").text($("#country option:eq(1)").text());
				$("#country option:eq(1)").attr("selected","selected");
				$("#country_chosen .chosen-single span").text($("#country option:eq(1)").text());	
			}
		}
		
		if (questionid=='MM355all'){	
			removeCountrys2();
			if ($("#country option:eq(3)").attr("selected")
			){
				$("#country option:eq(0)").attr("selected","selected");
				$("#country_chosen .chosen-single span").text($("#country option:eq(0)").text());	
			}
		}
		
		if (questionid=='MM358'){	
			removeCountrys2();
			if ($("#country option:eq(18)").attr("selected")
				|| $("#country option:eq(27)").attr("selected")
			){
				$("#country option:eq(0)").attr("selected","selected");
				$("#country_chosen .chosen-single span").text($("#country option:eq(0)").text());	
			}
		}
	}
	
	if (($("#plot").val()) == 'crossCountry' && surveyid=='esener1'){
		c1 =  $("#country option:selected").val();
		c2 =  $("#countryB option:selected").val();
		sv = $("#subsetValue option:selected").val();
		
		
		if (questionid=='MM303a'){
			if (c1=="CY" || c2 == "CY"|| c1=="EE" || c2 == "EE"||  c1=="MT" || c2 == "MT"){
				alert(alertnotdis);
				jQuery("#country option:eq(0)").attr("selected","selected");	
				jQuery("#countryB option:eq(0)").attr("selected","selected");
				window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"));
				return false;
			}
		}
		
		if (questionid=='MM350'){
			if (c1=="CY" || c2 == "CY"|| c1=="SE" || c2 == "SE"||  c1=="MT" || c2 == "MT"){
				alert(alertnotdis);
				jQuery("#country option:eq(0)").attr("selected","selected");	
				jQuery("#countryB option:eq(0)").attr("selected","selected");
				window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"));
				return false;
			}
		}
		if (questionid=='MM351'){
			removeCountrys2();
			
			if ( c1=="AT" || c2=="AT" || c1=="DE" || c2 == "DE"||  c1=="LU" || c2 == "LU"){
				jQuery("#country option:eq(1)").attr("selected","selected");	
				$("#country_chosen a span").text($("#country option:eq(1)").text());
				jQuery("#countryB option:eq(0)").attr("selected","selected");
				$("#countryB_chosen a span").text($("#countryB option:eq(0)").text());
				alert(alertnotdis);
				//window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"));
				return false;
			}
		}
		if (questionid=='MM355all'){
			if (c1=="CH" || c2 == "CH"){
				alert(alertnotdis);
				jQuery("#country option:eq(0)").attr("selected","selected");	
				jQuery("#countryB option:eq(0)").attr("selected","selected");
				window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
				return false;
			}
		}
		if (questionid=='MM358'){
			if (c1=="LU" || c2 == "LU"|| c1=="SI" || c2 == "SI"){
				alert(alertnotdis);
				jQuery("#country option:eq(0)").attr("selected","selected");	
				jQuery("#countryB option:eq(0)").attr("selected","selected");
				window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
				return false;
			}
		}
	}
	//************************************************************************
	
    if ($("#label_subset").hasClass("hidden")) {
        $visualizationFilters.find(".filtersLeft, filtersRight").addClass("hidden")
    } else {
        $visualizationFilters.find(".filtersLeft, filtersRight").removeClass("hidden")
    }
    $("label_csvView").removeClass("checked");
    var d = $("#label_onlyEU");
    var a = $(".euOnly");
    if (!d.hasClass("hidden")) {
        a.removeClass("hidden");
        if (d.find("input").is(":checked")) {
            d.addClass("checked");
            a.addClass("selected");
            var b = d.find("span").attr("pressed");
            d.find("span").text(b)
        } else {
            a.removeClass("selected");
            var b = d.find("span").attr("unpressed");
            d.find("span").text(b)
        }
    } else {
        a.addClass("hidden")
    }
    var e = $("section.visualizationFilters");
    for (var c = 0; c < plotsParameters.length; c++) {
        e.removeClass(plotsParameters[c])
    }
    e.addClass($("#plot").val());
    setTimeout(rwdVisualizationSelection, 300);
    setTimeout(rwdVisualizationFilters, 400)
}

function getFormParameters(a) {
    var b = a.serialize();
    b = b.replace(/&=.*&/g, "&");
    return b
}

function styleVisualizationDescription(a) {
    if (a == "" || a.indexOf(".") == -1) {
        return a
    }
    var b = a.substring(0, a.indexOf(".") + 1);
    var d = a.substring(a.indexOf(".") + 1);
    var c = new RegExp("([^.]*\\.)", "g");
    d = d.replace(c, "<li>$1</li>").replace(/<li> - /g, "<li class='indent'> - ");
    return b + "<br/><br/><ul>" + d.replace(/Â·/g, ".") + "</ul>"
}

function updateVisualizationDepedencies() {
    var d = getFormParameters($("#graphControlsForm"));
    imgURL = server + "/DVS/render/?" + d;
    var h = imgURL.replace("media=svg", "media=png");
    var g = h.replace("media=png", "media=xls");
    var f = h.replace("media=png", "media=pdf");
    var e = h.replace("media=png", "media=eps");
    var a = h.replace("media=png", "media=svg");
    $("#pngExport").attr("href", h + "&download&entitle=true");
    $("#urlExport").attr("href", window.location.pathname + "?" + d + "&bookmark=true");
    $("#toolUrlExport").attr("href", getBaseUrl() + window.location.pathname + "?" + d);
    $("#csvExport").attr("href", g);
    $("#pdfExport").attr("href", f);
    $("#epsExport").attr("href", e);
    $("#svgExport").attr("href", a);
    $("#svgExport").click(function() {
        var k = $(this);
        var j = k.attr("href");
        if (j.indexOf("download") == -1) {
            k.attr("href", j + "&download")
        }
    });
    if (isInitialized) {
        if (!svgSupported) {
            var c = $("#visualization");
            var b = $("#gifLoadingAnimation");
            if (!isFirst) {
                c.fadeTo("slow", 0).css("height", "0px");
                b.removeClass("hidden").css("opacity", "0").css("height", "740px").fadeTo("slow", 1)
            }
            c.attr("src", imgURL).load(function() {
                if (!isFirst) {
                    c.css("height", "auto").fadeTo("fast", 1);
                    b.addClass("hidden").css("opacity", "0").css("height", "0px")
                }
                isFirst = false
            })
        } else {
            updateSVG()
        }
        $.ajax({
            url: server + "/DVS/render/plots/txt/" + getPlotBodyFileName() + ".htm?v=1",
            data: data,
            success: function(j) {
                $($(".freetext p")[0]).html(styleVisualizationDescription(j));
                $("#visualization").attr("alt", j);
                setTimeout(updateTooltipsJs, 600);
				
				
            },
            error: function(l, j, k) {
                setTimeout(updateDescriptionTrial2, 1700);
            }
        });
        trackPageView(imgURL.replace("?", "index.php?"));
    }
}

function trackPageView(a) {}

function updateDescriptionTrial2() {
    $.ajax({
        url: server + "/DVS/render/plots/txt/" + getPlotBodyFileName() + ".htm?v=2",
        success: function(a) {
            $($(".freetext p")[0]).html(styleVisualizationDescription(a));
            $("#visualization").attr("alt", a);
            setTimeout(updateTooltipsJs, 600)
        },
        error: function(c, a, b) {
            setTimeout(updateDescriptionTrial3, 1700)
        }
    })
}

function updateDescriptionTrial3() {
    $.ajax({
        url: server + "/DVS/render/plots/txt/" + getPlotBodyFileName() + ".htm?v=2",
        data: data,
        success: function(a) {
            $($(".freetext p")[0]).html(styleVisualizationDescription(a));
            $("#visualization").attr("alt", a);
            setTimeout(updateTooltipsJs, 600)
        },
        error: function(c, a, b) {
            setTimeout(updateDescriptionTrial4, 1700)
        }
    })
}

function updateDescriptionTrial4() {
    $.ajax({
        url: server + "/DVS/render/plots/txt/" + getPlotBodyFileName() + ".htm?v=2",
        data: data,
        success: function(a) {
            $($(".freetext p")[0]).html(styleVisualizationDescription(a));
            $("#visualization").attr("alt", a);
            setTimeout(updateTooltipsJs, 600)
        },
        error: function(c, a, b) {}
    })
}

function getPlotBodyFileName() {
    parameters = plotFilesParameters[$.inArray($("#plot").val(), plotFilesParameters) + 1];
    var a = $("#plot").val();
    for (i = 0; i < parameters.length; i++) {
        if (parameters[i] == "onlyEU") {
            if ($("#" + parameters[i]).is(":checked")) {
                a = a + "-EU"
            }
        } else {
            a = a + "-" + $("#" + parameters[i]).val()
        }
    }
    return a
}

function loadOptGroupSelectValues(f, b) {
    (f.style || f).visibility = "visible";
    f.options.length = 0;
    var d = "";
    var a = [];
    for (i = 0; i < b.length; i++) {
        var c = b[i][0];
        if (c != d) {
            d = c;
            var e = document.createElement("optgroup");
            e.label = d;
            a[a.length] = e
        }
        $(e).append('<option value="' + b[i][1] + '">' + b[i][2] + "</option>")
    }
    f.appendChild(new Option("", ""));
    for (i = 0; i < a.length; i++) {
        f.appendChild(a[i])
    }
    f.options[0].selected = true
}

function loadSelectValues(b, a) {
    (b.style || b).visibility = "visible";
    b.options.length = 0;
    for (i = 0; i < a.length; i++) {
        b.options[b.options.length] = new Option(a[i][1], a[i][0])
    }
    b.options[0].selected = true
}

function loadInverseSelectValues(b, a) {
    (b.style || b).visibility = "visible";
    b.options.length = 0;
    for (i = a.length - 1; i >= 0; i--) {
        b.options[b.options.length] = new Option(a[i][1], a[i][0])
    }
    b.options[0].selected = true
}

function initLinkedSelect(c, b, a) {
    (c.style || c).visibility = "visible";
    $(c).change(function() {
        var d = c.options[c.selectedIndex].value;
        b.options.length = 0;
        for (i = 0; i < a.length; i++) {
            if (a[i][0] == d || d == "") {
                b.options[b.options.length] = new Option(a[i][2], a[i][1])
            }
        }
        b.options[0].selected = true;
        $(b).trigger("change")
    });
    $(c).change()
}
var latestTriggeredSelect = "";

function onChangeUpdateVisualization(a) {
	
    $(a).change(function() {
        latestTriggeredSelect = $(this).attr("id");
        var b = latestTriggeredSelect;
        setTimeout(function() {
            updateVisOnChainFinished(b)
        }, 100);
        isInitialized = false;
        updateVisualization()
    })
}

function updateAfterParameters() {
    hadUrlParameters = false;
    isInitialized = true;
    updateVisualizationDepedencies();
    if (window.location.search.replace("?", "").indexOf("bookmark") != -1) {
        bookmarkThisPage()
    }
}

function updateVisOnChainFinished(a) {
    if (a == latestTriggeredSelect) {
        if (!hadUrlParameters) {
            isInitialized = true;
            updateVisualizationDepedencies()
        }
    }
}

function getParameterValueFromUrl(b, a) {
    if (a.indexOf(b) != -1) {
        return a.replace(new RegExp(".*" + b + "="), "").replace(/[&#].*$/g, "")
    }
    return ""
}

function updateSelectFromUrl(b, a) {
    var c = getParameterValueFromUrl(b, a);
    return selectOptionTriggerChange(b, c)
}

function selectOptionTriggerChange(b, d) {
    var c = $("#" + b)[0];
    var a = selectOptionChange(b, d);
    $(c).trigger("change");
    return a
}

function selectOptionChange(a, d) {
    var b = $("#" + a)[0];
    inIndex = -1;
    for (var c = 0; c < b.options.length; c++) {
        if (b.options[c].value == d) {
            inIndex = c;
            b.options[inIndex].selected = true;
            return d
        }
    }
    return false
}
var incompletePDFonVisualizations = ["inCountry", "crossCountry", "wordMap", "euCompass"];

function visualizationFunctionChange(b) {
    var d = b[b.selectedIndex].value;
    $proxy_plot = $("#proxy_plot" + b.selectedIndex);
    if (!$proxy_plot.parent().hasClass("checked")) {
        $("label.checked").removeClass("checked");
        $proxy_plot.parent().addClass("checked")
    }
    var c = plotsParameters[$.inArray(d, plotsParameters) + 1];
    disableEnableFormParameters(c);
    var a = $("#plot").val();
    if ($.inArray(a, incompletePDFonVisualizations) != -1) {
        $("#pdfExport").addClass("hidden")
    } else {
        $("#pdfExport").removeClass("hidden")
    }
}

function disableEnableFormParameters(c) {
    for (var b = 0; b < allParameters.length; b++) {
        var a = $.inArray(allParameters[b], c);
        if (a == -1) {
            disableFormElement($("#" + allParameters[b]))
        } else {
            enableFormElement($("#" + allParameters[b]))
        }
    }
    $("#question").trigger("change")
}

function disableFormElement(a) {
    a.parent().addClass("hidden");
    a.attr("name", "")
}

function enableFormElement(a) {
    a.parent().removeClass("hidden");
    a.attr("name", a.attr("id"))
}

function changeClassOnHover(b, a) {
    $(b).mouseenter(function() {
        $(this).addClass(a)
    }).mouseleave(function() {
        $(this).removeClass(a)
    })
}

function updateQuestionChangeDependentElements() {
    var c = $("#question")[0];
    var k = $("#question option:selected").val();
    var l = $("#question option:selected").text();
    var n = getColumnValueFromKeyColumn(k, 1, 0, topic_question);
    var d = getColumnValueFromKeyColumn(k, 0, 1, question_meta);
    var g = getColumnValueFromKeyColumn(k, 0, 2, question_meta);
    $questionNoteP = $("#questionNoteP");
    if (g != "") {
        g += "<br><br>" + $("#plot option:selected").attr("title")
    } else {
        g = $("#plot option:selected").attr("title")
    }
    $questionNoteP.html(g);
    $("#webTitle_question").html(" / " + l);
    if (d == l) {
        $("#webTitle_question").addClass("hidden")
    } else {
        $("#webTitle_question").removeClass("hidden")
    }
    var j = $(elementsOnQuestionUpdate);
    j.html(d);
    j.attr("title", d);
    $("#title_topic").html(n);
    var f = $("#prevQuest");
    var h = $("#nextQuest");
    var b = c.selectedIndex;
    var m = c.length;
    var a = c[b > 0 ? b - 1 : m - 1].text;
    var e = c[b < m - 1 ? b + 1 : 0].text;
    if (a.length == 0) {
        a = c[m - 1].text
    }
    if (e.length == 0) {
        e = c[1].text
    }
    f.attr("title", a);
    h.attr("title", e);
    document.title = getVisualizationTitle()
}

function getColumnValueFromKey(c, a, b) {
    return getColumnValueFromKeyColumn(c, 0, a, b)
}

function getColumnValueFromKeyColumn(e, b, c, d) {
    for (var a = 0; a < d.length; a++) {
        if (e == d[a][b]) {
            return d[a][c]
        }
    }
    return ""
}

function nextQuestion() {
    $questions = $("#question")[0];
    questionIndex = $questions.selectedIndex;
    questionsLength = $questions.length;
    $questions.selectedIndex = questionIndex < questionsLength - 1 ? questionIndex + 1 : 1;
	
    $("#question").trigger("change")
}

function prevQuestion() {
    
	$questions = $("#question")[0];
    questionIndex = $questions.selectedIndex;
	questionsLength = $questions.length;
	$questions.selectedIndex = questionIndex == 1 ? questionsLength - 1 : questionIndex - 1;
	
    $("#question").change()
}

function scrollTo(a) {
    $("html, body").animate({
        scrollTop: $(a).offset().top + "px"
    }, {
        duration: 500,
        easing: "swing"
    })
}

function bookmarkThisPage() {
    var b = window.location.href;
    var a = getVisualizationTitle();
    if ($.browser.mozilla) {
        window.sidebar.addPanel(a, b, "")
    } else {
        alert("Please press CTRL+D to bookmark the page.\n (Your browser does not support the bookmark action automatically.)");
        document.title = a;
        return false
    }
}

function getVisualizationTitle() {
    var a = $("#question option:selected").text() + " (" + $("#title_topic").html() + ") " + getDropDownToText("plot");
    if ($("#subset").attr("name") != "") {
        a = a + " " + getDropDownToText("subset")
    }
    if ($("#subsetValue").attr("name") != "") {
        a = a + ", " + getDropDownToText("subsetValue")
    }
    if ($("#country").attr("name") != "") {
        a = a + ", " + getDropDownToText("country")
    }
    if ($("#countryB").attr("name") != "") {
        a = a + ", " + getDropDownToText("countryB")
    }
    if ($("#answer").attr("name") != "") {
        a = a + ", " + getDropDownToText("answer")
    }
    a = a + " - " + $("h1").text();
    return a
}

function getDropDownToText(a) {
    return $("#label_" + a + " span").text().toLowerCase() + " " + $("#" + a + " option:selected").text()
}

function selectElementsBasedOnUrl() {
    if (window.location.search.indexOf("?") != -1) {
        hadUrlParameters = true;
        isInitialized = false;
        var a = window.location.search.replace("?", "");
        if (b = updateSelectFromUrl("plot", a)) {
            updateSelectFromUrl("plot", a);
            updateSelectFromUrl("question", a);
            for (var c = 0; c < allParameters.length; c++) {
                if (allParameters[c] == "onlyEU") {
                    var b = getParameterValueFromUrl(allParameters[c], a);
                    if (b == "onlyEU") {
                        $("#onlyEU").click()
                    }
                } else {
                    updateSelectFromUrl(allParameters[c], a)
                }
            }
        }
        setTimeout(updateAfterParameters, 200)
    }
}
var header = [],
    data = [],
    sorted = [],
    sortColumn = -1,
    asc = 1;
var elementJQueryToInsert = "#visualizationData";

function resetCSViewer() {
    $(elementJQueryToInsert).innerHTML = "";
    header = [], data = [], sorted = [], sortColumn = -1, asc = 1
}

function viewVisualizationData() {
    $.get($("#csvExport").attr("href"), function(a) {
        parseEFCSV(a.replace(/\"/g, "").replace(/\n$/g, ""))
    });
    $("#visualizationData").removeClass("hidden");
    if (!svgSupported) {
        $("#visualization").addClass("hidden")
    } else {
        $("#svgContainer").addClass("hidden")
    }
}

function swapVisualizationData() {
    if (!svgSupported) {
        $("#visualization").removeClass("hidden")
    } else {
        $("#svgContainer").removeClass("hidden")
    }
    $("#visualizationData").addClass("hidden")
}

function parseEFCSV(c) {
    resetCSViewer();
    mRows = c.split("\n");
    for (var b = 0; b < mRows.length; b++) {
        if (b > 0) {
            data[b - 1] = []
        }
        rawMrow = mRows[b];
        mRowColumns = rawMrow.split("\t");
        for (var a = 0; a < mRowColumns.length; a++) {
            mcell = mRowColumns[a].length == 0 ? "&nbsp;" : mRowColumns[a];
            if (b == 0) {
                mcell = mcell.replace("CountryCode", "Country").replace("question_code", "Question Id").replace("subset", "Subset").replace("answer", "Answer").replace("percentage", "Percentage");
                header.push('<a href="javascript:" onclick = sortBy(' + a + ")>" + mcell + "</a>")
            } else {
                data[b - 1].push(mcell)
            }
        }
    }
    sorted = data;
    generateHtmlTable()
}

function generateHtmlTable() {
    var c = [];
    $(".table-menu input").each(function() {
        var e = $(this);
        if (!e.prop("checked")) {
            c.push(e.attr("id"))
        }
    });
    var a, d = $(elementJQueryToInsert)[0];
    d.innerHTML = "";
    a = '<div class="table-wrapper"><table id="csvData"><thead><tr align="left"><th class="optional">' + header.join("</th><th>") + "</th></tr></thead><tbody>";
    for (mRowIndex = 0; mRowIndex < sorted.length; mRowIndex++) {
        a += '<tr align="left"><td>' + sorted[mRowIndex].join("</td><td>") + "</td></tr>"
    }
    a += "</table></div>";
    d.innerHTML = a;
    rwdTable();
    for (var b = 0; b < c.length; b++) {
        $("#" + c[b]).click()
    }
}

function indexTable(b) {
    var a = [];
    for (var c = 0; c < b.length; c++) {
        a[c] = b[c];
        a[c][a[c].length] = c
    }
    return a
}

function filterArrayTableBy(c, b, d) {
    var a = [];
    for (var e = 0; e < c.length; e++) {
        if (c[e][b] == d) {
            a[a.length] = c[e]
        }
    }
    return a
}

function uniqueArrayTableBy(c, b) {
    var a = [];
    for (var d = 0; d < c.length; d++) {
        if (jQuery.inArray(c[d][b], a) == -1) {
            a[a.length] = c[d][b]
        }
    }
    return a
}

function orderArrayTableBy(b, c, a) {
    return b.sort(function(e, d) {
        var f = parseInfoValue(e[c]);
        var g = parseInfoValue(d[c]);
        if (f > g) {
            return (a) ? 1 : -1
        }
        if (f < g) {
            return (a) ? -1 : 1
        }
        return 0
    })
}

function sortBy(a) {
    asc = sortColumn == a ? !asc : 1;
    sortColumn = a;
    sorted = orderArrayTableBy(data, sortColumn, asc);
    generateHtmlTable()
}

function parseInfoValue(a) {
    result = "";
    a = a.replace(",", ".");
    if (a != null) {
        if (isNaN(a)) {
            return a.toUpperCase()
        }
        return parseFloat(a)
    }
    return result
}
var widthState = 1;
var $window = $(window);
var $wrapper = $("#wrapper");
var previousWindowWidth = $wrapper.width() + 1;
var mediaAvailableResponsiveWidths = [920, 740, 500];
var cssAttributesLeftRightMargin = ["margin-left", "margin-right"];
var cssAttributesLeftRightPadding = ["padding-left", "padding-right"];

function expandUntilChangeOfHeigth(d, a, g, h, f, e) {
    f = f || 800;
    e = e || "px";
    h = h || 1;
    $elementToExpand = $(d);
    $elementToObserve = $(a);
    var j = $elementToObserve.height();
    var b = 1;
    var k = h;
    for (var c = 0; c < 2; c++) {
        for (; k < f; k = k + b) {
            setValueInCSSAttributes($elementToExpand, g, k, e);
            curentElementHeigth = $elementToObserve.height();
            if (j != curentElementHeigth) {
                if (k != h) {
                    k = k - b
                }
                setValueInCSSAttributes($elementToExpand, g, k, e);
                b = 1;
                break
            }
            b++;
            if (b > 20) {
                b = 10
            }
            if (c == 1) {
                b = 1
            }
            j = curentElementHeigth
        }
    }
}

function setValueInCSSAttributes(d, c, a, b) {
    b = b || "px";
    for (var e = 0; e < c.length; e++) {
        d.css(c[e], a + b)
    }
}

function findMaxWidthAmongElements(a) {
    var b = 0;
    a.each(function() {
        var c = $(this).width();
        if (c > b) {
            b = c
        }
    });
    return b + 2
}

function indentElements(a) {
    a.css("width", "auto");
    a.css("width", findMaxWidthAmongElements(a))
}

function ifInRowsOptimizeRows(d, e, b, f) {
    $elements = $(d);
    $elements.filter(":visible");
    var a = 0;
    var g = "none";
    for (var c = 0; c < 20; c++) {
        $(".layer" + c).removeClass("layer" + c)
    }
    $elements.each(function() {
        $this = $(this);
        var h = $this.position().top;
        if (g != h) {
            a++;
            g = h;
            $this.addClass("layer" + a)
        } else {
            $this.addClass("layer" + a)
        }
    });
    if (a > 1) {
        for (var c = 1; c <= a; c++) {
            expandUntilChangeOfHeigth($elements.filter(".layer" + c), e, b, f);
            expandUntilChangeOfHeigth($elements.filter(".layer" + c), e, b, f)
        }
    }
    return a
}

function responsiveAutoArrange() {
    calculateResponsiveHeightForAndroid();
    rwdQuestionSelection();
    rwdVisualizationSelection();
    rwdVisualizationFilters();
    updateProxyPlot()
}

function rwdQuestionSelection() {
    return "disabled";
    $questionSection = $(".questionSection");
    if ($questionSection.hasClass("hidden")) {
        return "not necessary"
    }
    $questionSectionLabel = $(".questionSection label");
    if (widthState != 1) {
        indentElements($questionSectionLabel.find("span:visible"))
    }
    expandUntilChangeOfHeigth($questionSectionLabel.find("select:visible"), $questionSection, ["width"]);
    if ($wrapper.width() > 700) {
        expandUntilChangeOfHeigth("#question", $questionSection, ["width"])
    }
}

function rwdVisualizationFilters() {
    return "disabled";
    $visualizationFilters = $(".visualizationFilters");
    var a = $visualizationFilters.find(".filtersLeft").position().top == $visualizationFilters.find(".filtersRight").position().top;
    if (!a) {
        indentElements($visualizationFilters.find("div label span:visible"))
    }
    var b = (widthState == 1 ? 180 : 700);
    expandUntilChangeOfHeigth($visualizationFilters.find("label select:visible"), $visualizationFilters, ["width"], 1, b);
    expandUntilChangeOfHeigth($visualizationFilters.find(".filtersRight label select:visible"), $visualizationFilters, ["width"], 1, b + 140);
    if (!a) {
        expandUntilChangeOfHeigth($visualizationFilters.find("#label_subset_value select:visible"), $visualizationFilters, ["width"], 1, b)
    }
}

function rwdVisualizationSelection() {
    return "disabled rwdVisualizationSelection";
    $visualizationSelection = $(".visualizationSelection");
    $visualizationSelectionLabel = $visualizationSelection.find("label:visible");
    setValueInCSSAttributes($visualizationSelectionLabel, cssAttributesLeftRightPadding, 3);
    if (widthState == 3) {
        expandUntilChangeOfHeigth($visualizationSelectionLabel.find("select:visible"), $visualizationSelection, ["width"], 3)
    } else {
        expandUntilChangeOfHeigth($visualizationSelectionLabel.find("span:visible"), $visualizationSelection, cssAttributesLeftRightPadding, 3)
    }
    expandUntilChangeOfHeigth($visualizationSelection.find(".filtersRight label span:visible"), $visualizationSelection, cssAttributesLeftRightPadding, 3);
    ifInRowsOptimizeRows("#formatSelector label", $visualizationSelection, cssAttributesLeftRightPadding, 3)
}

function hasAttribute(b, c) {
    var a = $(b).attr(c);
    if (typeof a !== "undefined" && a !== false) {
        return true
    }
    return false
}

function rwdExportSection() {
    return "";
    $exportSection = $("#exportSection :visible");
    if ($exportSection.length == 0) {
        return ""
    }
    $exportSectionLinks = $exportSection.find("a");
    if (widthState == 3) {
        $exportSectionLinks.css("padding", 15);
        return
    }
    expandUntilChangeOfHeigth($exportSectionLinks, $exportSection, cssAttributesLeftRightPadding, 5);
    var a = ifInRowsOptimizeRows($exportSectionLinks, $exportSection, cssAttributesLeftRightPadding, 5)
}

function initResizeDetection() {
    $window = $(window);
    $wrapper = $("#wrapper");
    previousWindowWidth = $wrapper.width() + 1;
    setInterval(attemptToResize, 2000)
}

function attemptToResize() {
    if ($wrapper.width() != previousWindowWidth) {
        previousWindowWidth = $wrapper.width();
        onWindowResize()
    }
}

function onWindowResize() {
    updateMediaBasedOnWidth();
    var a = new Date().getTime();
    responsiveAutoArrange();
    responsiveAutoArrange();
    rwdExportSection();
    onWindowResizeExtra();
    $("#time").text("RWD Execution time: " + (new Date().getTime() - a))
}

function onWindowResizeExtra() {}

function updateMediaBasedOnWidth() {
    var a = $("#visualizationSection").width();
    if (a < 50) {
        a = mediaAvailableResponsiveWidths[0]
    }
    if (a > mediaAvailableResponsiveWidths[1]) {
        if (widthState != 1) {
            widthState = 1;
            $("#pngWidth").val(mediaAvailableResponsiveWidths[0]);
            updateVisualization();
            updateMaskMap()
        }
    } else {
        if (a > mediaAvailableResponsiveWidths[2] && a <= mediaAvailableResponsiveWidths[1]) {
            if (widthState != 2) {
                widthState = 2;
                $("#pngWidth").val(mediaAvailableResponsiveWidths[1]);
                updateVisualization();
                updateMaskMap()
            }
        } else {
            if (a <= mediaAvailableResponsiveWidths[2]) {
                if (widthState != 3) {
                    widthState = 3;
                    $("#pngWidth").val(mediaAvailableResponsiveWidths[2]);
                    updateVisualization();
                    updateMaskMap()
                }
            }
        }
    }
}
var colorToCountry = [
    ["f8766d", "AL"],
    ["f27c55", "AT"],
    ["eb8335", "BA"],
    ["e38900", "BE"],
    ["da8f00", "BG"],
    ["cf9400", "BY"],
    ["ec69ef", "RS"],
    ["70b000", "CH"],
	["c49a00", "CY"],
    ["b79f00", "CZ"],
    ["a9a400", "DE"],
    ["99a800", "DK"],
    ["86ac00", "EE"],
    ["53b400", "EL"],
    ["1db700", "ES"],
    ["00ba38", "FI"],
    ["00bc56", "FR"],
    ["00be6d", "HR"],
    ["00bf81", "HU"],
    ["00c094", "IE"],
    ["00c0b5", "IT"],
    ["00bdd2", "LT"],
    ["00badf", "LU"],
    ["00b6eb", "LV"],
    ["00b1f5", "MD"],
    ["00abfd", "ME"],
    ["06a4ff", "MK"],
    ["619cff", "MT"],
    ["8893ff", "NL"],
    ["a58aff", "NO"],
    ["bd81ff", "PL"],
    ["d078ff", "PT"],
    ["df70f8", "RO"],
    ["f564e3", "SE"],
    ["fb61d7", "SI"],
    ["ff61c8", "SK"],
    ["ff63b9", "TR"],
    ["ff66a8", "UA"],
    ["ff6b96", "UK"],
    ["00c1a5", "IS"],
    ["fc7082", "XK"],
    
];
var countryToPathD = [
	["AL", "M 406.1 489.1 L 404.1", 740],
    ["DK", "M 314.1 252.2 L 317.5", 740],
    ["IS", "M 81.7 63.9 L 71.7 60", 740],
    ["FI", "M 462.1 163 L 459.5 1", 740],
    ["SE", "M 321.3 190 L 322.9 1", 740],
    ["SE", "M 321.3 190.1 L 322.9", 740],
    ["NO", "M 321.3 190 L 319.4 1", 740],
    ["NO", "M 358.3 47.8 L 360 43", 740],
	["CH", "M 255.3 388.8 L 252.9", 740],
    ["SE", "M 388.4 208 L 386.4 2", 740],
    ["SE", "M 371.3 216.9 L 368.4", 740],
    ["EE", "M 436.8 206.6 L 438.1", 740],
    ["EE", "M 423.5 196.2 L 426.8", 740],
    ["EE", "M 419.9 188.9 L 423.8", 740],
    ["EE", "M 451.8 197.9 L 452 2", 740],
    ["EE", "M 458.3 256.7 L 460.3", 740],
    ["EE", "M 425.6 195 L 427.2 1", 740],
    ["EE", "M 464.8 187.6 L 467 1", 740],
    ["LV", "M 408.5 235.8 L 407.3", 740],
    ["LT", "M 411.2 248.4 L 408.5", 740],
    ["PL", "M 346.7 316.3 L 349 3", 740],
    ["DE", "M 264.5 363.7 L 265.5", 740],
    ["DE", "M 342.3 269.9 L 338.3", 740],
    ["CZ", "M 334.8 348.5 L 328.7", 740],
    ["SK", "M 370.9 360.9 L 367.4", 740],
    ["AT", "M 286 372.9 L 285.7 3", 740],
    ["HU", "M 359 378.3 L 363.8 3", 740],
    ["SI", "M 330 399.3 L 331.4 3", 740],
    ["HR", "M 375 438.9 L 367.4 4", 740],
    ["IT", "M 257.3 422.4 L 259.6", 740],
    ["IT", "M 351 511.3 L 343.9 5", 740],
    ["IT", "M 274.2 462.7 L 277.9", 740],
    ["IT", "M 314.8 423 L 315.1 4", 740],
    ["ME", "M 387 446.6 L 387.6 4", 740],
    ["ME", "M 376.8 440 L 379.3 4", 740],
    ["RS", "M 394.6 430.3 L 396.1", 740],
    ["RO", "M 435.5 418.3 L 432.5", 740],
    ["RO", "M 28.3 0 L 721.3 0 L ", 740],
    ["RO", "M 421.9 263.6 L 423.3", 740],
    ["RO", "M 420 264.7 L 423.1 2", 740],
    ["RO", "M 458.3 256.7 L 460.3", 740],
    ["RO", "M 446.2 266.3 L 446.4", 740],
    ["RO", "M 432.3 274.4 L 433.5", 740],
    ["RO", "M 431 470.6 L 428.3 4", 740],
    ["BG", "M 440.9 462.8 L 441.8", 740],
    ["XK", "M 408.9 440.4 L 414.2", 740],
    ["MK", "M 417.4 470.9 L 414.3", 740],
    ["EL", "M 433.9 511.2 L 443 5", 740],
    ["EL", "M 473.3 482.2 L 472.3", 740],
    ["EL", "M 475.1 474.4 L 474.6", 740],
    ["EL", "M 490 554.1 L 488.8 5", 740],
    ["EL", "M 490 554.1 L 488.8 5", 740],
    ["EL", "M 490 554.1 L 488.7 5", 740],
    ["TR", "M 613.6 536.1 L 610.8", 740],
    ["TR", "M 479.5 470.6 L 483.4", 740],
    ["MT", "M 336.7 547.9 L 334.8", 740],
    ["CY", "M 596.9 541.7 L 589.2", 740],
    ["DK", "M 289.2 251.5 L 289.8", 740],
    ["DK", "M 309.4 242.1 L 309.4", 740],
    ["DK", "M 327.9 235.4 L 328.1", 740],
    ["DK", "M 314.1 252.1 L 317.5", 740],
    ["DK", "M 311.4 249.2 L 308.7", 740],
    ["DK", "M 319.9 252.4 L 322.7", 740],
    ["DK", "M 324.3 251 L 326.6 2", 740],
    ["DK", "M 331.8 262.5 L 332.3", 740],
    ["DK", "M 348.8 248.2 L 352.1", 740],
    ["NL", "M 227.9 301.3 L 237.6", 740],
    ["BE", "M 218.5 304.9 L 227.9", 740],
    ["LU", "M 249 332.1 L 249 326", 740],
    ["FR", "M 146.8 418.4 L 150.4", 740],
    ["FR", "M 278.7 435.8 L 279 4", 740],
    ["FR", "M 186.1 436.9 L 182.7", 740],
    ["FR", "M 264.2 475.1 L 264.8", 740],
    ["FR", "M 146.8 418.4 L 150.4", 740],
    ["PT", "M 56.3 507.1 L 48.6 5", 740],
    ["ES", "M 56.3 507.1 L 56.5 5", 740],
    ["ES", "M 197.4 477.8 L 196.4", 740],
    ["ES", "M 56.4 507.1 L 56.5 5", 740],
    ["ES", "M 175.2 489.2 L 175.3", 740],
    ["ES", "M 197.4 477.7 L 196.4", 740],
    ["ES", "M 210.4 477.8 L 211 4", 740],
    ["PT", "M 56.4 507.1 L 48.7 5", 740],
    ["TR", "M 613.6 536.1 L 610.8", 740],
    ["TR", "M 479.5 470.6 L 483.4", 740],
    ["IE", "M 141.4 245.8 L 142.3", 740],
    ["IE", "M 158.5 310.7 L 159.3", 740],
    ["UK", "M 141.4 245.8 L 137.5", 740],
    ["UK", "M 141.4 245.8 L 137.6", 740],
    ["UK", "M 166.4 289.6 L 167.2", 740],
    ["UK", "M 166.4 289.6 L 159.2", 740],
    ["UK", "M 161.5 243.8 L 159.9", 740],
    ["UK", "M 176.3 237.2 L 171.5", 740],
    ["UK", "M 164.2 179.6 L 161.7", 740],
    ["UK", "M 197.5 176.9 L 192.8", 740],
    ["UK", "M 217.1 155.7 L 216.8", 740],
    ["UK", "M 177.6 118.5 L 179 1", 740],
    ["UK", "M 180 118.7 L 178.3 1", 740],
    ["UK", "M 181.6 351.3 L 174.9", 740],
    ["IS", "M 58.5 42.8 L 51.8 40", 500],
    ["FI", "M 313.4 109.2 L 311.6", 500],
    ["SE", "M 219.1 127.3 L 220.1", 500],
    ["SE", "M 264 139.3 L 262.6 1", 500],
    ["SE", "M 252.5 145.3 L 250.6", 500],
    ["EE", "M 296.4 138.4 L 297.3", 500],
    ["EE", "M 285.9 173.5 L 287.1", 500],
    ["EE", "M 315.2 125.6 L 316.7", 500],
    ["EE", "M 287.5 131.4 L 289.7", 500],
    ["EE", "M 285.1 126.5 L 287.7", 500],
    ["EE", "M 288.9 130.6 L 289.9", 500],
    ["EE", "M 306.5 132.6 L 306.6", 500],
    ["LV", "M 277.5 158 L 276.7 1", 500],
    ["LT", "M 279.2 166.4 L 277.5", 500],
    ["PL", "M 236.1 211.9 L 237.6", 500],
    ["DE", "M 181 243.6 L 181.6 2", 500],
    ["DE", "M 233.1 180.8 L 230.4", 500],
    ["CZ", "M 228.1 233.5 L 224 2", 500],
    ["SK", "M 252.3 241.8 L 249.9", 500],
    ["AT", "M 195.4 249.8 L 195.2", 500],
    ["HU", "M 244.3 253.4 L 247.5", 500],
    ["SI", "M 224.8 267.5 L 225.8", 500],
    ["HR", "M 255 294 L 249.9 289", 500],
    ["RO", "M 295.5 280.2 L 293.6", 500],
    ["RS", "M 268.1 288.2 L 269.1", 500],
    ["IT", "M 176.2 283 L 177.7 2", 500],
    ["IT", "M 187.5 310 L 190 311", 500],
    ["IT", "M 214.7 283.3 L 214.9", 500],
    ["IT", "M 238.9 342.5 L 234.2", 500],
    ["MK", "M 283.4 315.4 L 281.4", 500],
    ["EL", "M 294.4 342.4 L 300.5", 500],
    ["EL", "M 332 371.2 L 331.2 3", 500],
    ["EL", "M 320.8 323 L 320.2 3", 500],
    ["EL", "M 322.1 317.8 L 321.7", 500],
    ["TR", "M 414.8 359.1 L 413 3", 500],
    ["TR", "M 325 315.2 L 327.6 3", 500],
    ["SI", "M 224.8 267.5 L 225.8", 500],
    ["BE", "M 150.2 204.3 L 156.5", 500],
    ["LU", "M 170.6 222.5 L 170.6", 500],
    ["FR", "M 102.2 280.3 L 104.6", 500],
    ["FR", "M 190.5 291.9 L 190.7", 500],
    ["FR", "M 128.4 292.7 L 126.2", 500],
    ["FR", "M 215.5 210.6 L 213.8", 500],
    ["FR", "M 223.5 211.8 L 224.9", 500],
    ["FR", "M 220.8 212.6 L 222.5", 500],
    ["FR", "M 217.2 212.4 L 219.3", 500],
    ["FR", "M 228.2 218.8 L 228.5", 500],
    ["FR", "M 201.8 212 L 202.1 2", 500],
    ["FR", "M 195.2 326.4 L 195.4", 500],
    ["FR", "M 113.4 315.7 L 115.6", 500],
    ["FR", "M 137.7 327.1 L 135.6", 500],
    ["FR", "M 180.8 318.5 L 181.2", 500],
    ["CY", "M 403.6 362.9 L 398.5", 500],
    ["IE", "M 98.6 164.6 L 99.1 1", 500],
    ["IE", "M 110 208.5 L 110.6 2", 500],
    ["UK", "M 115.2 194 L 115.8 1", 500],
    ["UK", "M 115.2 194 L 110.5 1", 500],
    ["UK", "M 112 163.3 L 110.9 1", 500],
    ["UK", "M 121.9 158.9 L 118.7", 500],
    ["UK", "M 113.8 120.3 L 112.1", 500],
    ["UK", "M 136.1 118.5 L 133 1", 500],
    ["UK", "M 22.7 0 L 487 0 L 48", 500],
    ["UK", "M 122.7 79.4 L 123.7 ", 500],
    ["UK", "M 124.4 79.5 L 123.2 ", 500],
    ["UK", "M 98.6 164.6 L 95.9 1", 500],
    ["UK", "M 110 208.5 L 107.6 2", 500],
    ["ES", "M 41.6 339.7 L 41.6 3", 500],
    ["ES", "M 121.2 327.7 L 121.3", 500],
    ["ES", "M 136.1 320 L 135.4 3", 500],
    ["ES", "M 144.8 320.1 L 145.1", 500],
    ["PT", "M 41.6 339.7 L 36.4 3", 500],
    ["MT", "M 241.9 358.2 C 241.9", 500],
    ["ME", "M 256.1 329 L 257.7 3", 500],
    ["ME", "M 263.1 299.1 L 263.5", 500],
    ["XK", "M 277.7 295 L 281.3 2", 500],
    ["SI", "M 224.8 267.5 L 225.8", 500],
    ["NL", "M 156.5 201.9 L 163 2", 500],
    ["DK", "M 197.6 168.4 L 197.9", 500],
    ["DK", "M 211.1 162.2 L 211.1", 500],
    ["DK", "M 212.4 166.9 L 210.6", 500],
    ["DK", "M 214.2 168.9 L 216.5", 500],
    ["DK", "M 218.1 169.1 L 219.9", 500],
    ["DK", "M 223.4 157.7 L 223.6", 500],
    ["DK", "M 226.1 175.8 L 226.4", 500],
    ["DK", "M 228.2 218.8 L 228.5", 500],
    ["DK", "M 237.5 166.3 L 239.6", 500],
    ["DK", "M 195.2 326.4 L 195.4", 500],
    ["DK", "M 113.4 315.7 L 115.6", 500],
    ["DK", "M 137.7 327.1 L 135.6", 500],
    ["DK", "M 180.8 318.5 L 181.2", 500],
    ["BG", "M 299.2 310.1 L 299.8", 500],
    ["IS", "M 125.6 176.9 L 114.1", 920],
    ["FI", "M 565.8 291.5 L 562.7", 920],
    ["SE", "M 480.4 343.6 L 478.1", 920],
    ["SE", "M 460.7 353.9 L 457.3", 920],
    ["SE", "M 402.9 322.8 L 404.7", 920],
    ["EE", "M 516.9 321.5 L 521.5", 920],
    ["EE", "M 522.5 322.1 L 524.8", 920],
    ["EE", "M 523.6 328.5 L 525.3", 920],
    ["EE", "M 521.1 329.9 L 525 3", 920],
    ["EE", "M 568.9 319.9 L 571.5", 920],
    ["EE", "M 553.9 331.9 L 554.1", 920],
    ["EE", "M 536.5 342 L 538 334", 920],
    ["LV", "M 503.8 375.8 L 502.4", 920],
    ["LT", "M 506.8 390.4 L 503.8", 920],
    ["PL", "M 432.3 468.9 L 434.9", 920],
    ["DK", "M 410.4 375.3 L 410.8", 920],
    ["DK", "M 389.1 383.1 L 389.1", 920],
    ["DK", "M 434.7 390.2 L 438.4", 920],
    ["DK", "M 391.4 391.3 L 388.2", 920],
    ["DK", "M 406.3 393.4 L 409 3", 920],
    ["DK", "M 401.2 395 L 404.4 3", 920],
    ["DK", "M 394.5 394.7 L 398.4", 920],
    ["DK", "M 415 406.6 L 415.6 4", 920],
    ["DK", "M 365.8 393.9 L 366.4", 920],
    ["DE", "M 337.1 523.8 L 338.3", 920],
    ["DE", "M 427.1 415.2 L 422.5", 920],
    ["CZ", "M 418.4 506.2 L 411.4", 920],
    ["SK", "M 460.3 520.5 L 456.2", 920],
    ["AT", "M 362 534.4 L 361.7 5", 920],
    ["HU", "M 446.5 540.6 L 452 5", 920],
    ["SI", "M 412.9 564.9 L 414.6", 920],
    ["HR", "M 465 610.7 L 456.2 6", 920],
    ["HR", "M 420.7 736.9 L 418.5", 920],
    ["RO", "M 516.9 321.5 L 521.5", 920],
    ["RO", "M 522.5 322.1 L 524.8", 920],
    ["RO", "M 523.6 328.5 L 525.3", 920],
    ["RO", "M 521.1 329.9 L 525 3", 920],
    ["RO", "M 568.9 319.9 L 571.5", 920],
    ["RO", "M 553.9 331.9 L 554.1", 920],
    ["RO", "M 536.5 342 L 538 334", 920],
    ["RO", "M 534.9 586.9 L 531.6", 920],
    ["RS", "M 487.6 600.8 L 489.4", 920],
    ["BG", "M 541.3 638.5 L 542.3", 920],
    ["ME", "M 467.1 612 L 470 611", 920],
    ["ME", "M 478.9 619.6 L 479.6", 920],
    ["XK", "M 504.3 612.5 L 510.3", 920],
    ["MK", "M 514.1 647.7 L 510.5", 920],
    ["EL", "M 580.8 651.8 L 580.2", 920],
    ["EL", "M 578.7 660.9 L 577.5", 920],
    ["EL", "M 598 744.1 L 596.6 7", 920],
    ["EL", "M 533.1 694.4 L 543.6", 920],
    ["TR", "M 741 723.2 L 737.8 7", 920],
    ["TR", "M 585.9 647.4 L 590.3", 920],
    ["CY", "M 721.7 729.7 L 712.8", 920],
    ["IT", "M 348.4 638.3 L 352.7", 920],
    ["IT", "M 437.2 694.5 L 429 7", 920],
    ["IT", "M 328.9 591.7 L 331.5", 920],
    ["IT", "M 395.3 592.3 L 395.6", 920],
    ["MT", "M 420.7 736.9 L 418.5", 920],
    ["NL", "M 294.8 451.6 L 306 4", 920],
    ["BE", "M 284 455.7 L 294.8 4", 920],
    ["LU", "M 319.2 487.2 L 319.2", 920],
    ["FR", "M 410.4 375.3 L 410.8", 920],
    ["FR", "M 389.1 383.1 L 389.1", 920],
    ["FR", "M 434.7 390.2 L 438.4", 920],
    ["FR", "M 391.4 391.3 L 388.2", 920],
    ["FR", "M 406.3 393.4 L 409 3", 920],
    ["FR", "M 401.2 395 L 404.4 3", 920],
    ["FR", "M 394.5 394.7 L 398.4", 920],
    ["FR", "M 415 406.6 L 415.6 4", 920],
    ["FR", "M 365.8 393.9 L 366.4", 920],
    ["FR", "M 353.5 607.1 L 353.9", 920],
    ["FR", "M 201 587.1 L 205.2 5", 920],
    ["FR", "M 246.4 608.4 L 242.5", 920],
    ["FR", "M 326.7 592.5 L 327.4", 920],
    ["UK", "M 234.4 309 L 237.3 3", 920],
    ["UK", "M 239.3 240.3 L 237.4", 920],
    ["UK", "M 236.6 240.1 L 238.2", 920],
    ["UK", "M 282.2 283.1 L 281.9", 920],
    ["UK", "M 259.6 307.6 L 254.2", 920],
    ["UK", "M 221.1 310.8 L 218.2", 920],
    ["UK", "M 218 385 L 216.2 389", 920],
    ["UK", "M 223.6 438.1 L 224.6", 920],
    ["UK", "M 235.1 377.4 L 229.6", 920],
    ["UK", "M 223.6 438.1 L 215.3", 920],
    ["UK", "M 194.8 387.3 L 190.3", 920],
    ["IE", "M 189.3 367.9 L 193.2", 920],
    ["IE", "M 194.8 387.3 L 195.8", 920],
    ["ES", "M 274.6 655.7 L 275.2", 920],
    ["ES", "M 259.6 655.7 L 258.4", 920],
    ["ES", "M 233.9 669 L 234 671", 920],
    ["ES", "M 96.3 689.6 L 96.5 6", 920],
    ["PT", "M 96.3 689.6 L 87.4 6", 920]
];
var currentMouseOverCountry = "",
    mouseOverCountry = "previous",
    maskCanvas, maskCanvas2dContext;
var visTooltip;
var visualizationMask = new Image();

function getCountryFromColor(a) {
    for (var b = 0; b < colorToCountry.length; b++) {
        if (colorToCountry[b][0] == a) {
            return colorToCountry[b][1]
        }
    }
    return ""
}

function findPos(b) {
    setTimeout;
    var c = 0,
        a = 0;
    if (b.offsetParent) {
        do {
            c += b.offsetLeft;
            a += b.offsetTop
        } while (b = b.offsetParent);
        return {
            x: c,
            y: a
        }
    }
    return undefined
}

function rgbToHex(d, c, a) {
    if (d > 255 || c > 255 || a > 255) {
        throw "Invalid color component"
    }
    return ((d << 16) | (c << 8) | a).toString(16)
}

function getVisualizationMaskUrl(a) {
    return server + "/DVS/render/?plot=maskMap&media=png&width=" + a
}
var previousBaseWidth = 0;
var previousVisWidth = 0;

function changePreviousVisWidth() {
    previousVisWidth = 1024
}

function updateMaskMap() {
    if (!canvasSupported) {
        return "canvas not Supported"
    }
    var b = $("#pngWidth").val();
    $visualization = $("#visualization");
    if (svgSupported) {
        $visualization = $("#svgContainer")
    }
    var c = $visualization.width();
    var a = $visualization.height();
    if (a < 100) {}
    if (previousBaseWidth != b || previousVisWidth != c) {
        visualizationMask.src = getVisualizationMaskUrl(b);
        visualizationMask.onload = function() {
            maskCanvas.getContext("2d").drawImage(visualizationMask, 0, 0, c, a);
            maskCanvas2dContext = maskCanvas.getContext("2d")
        };
        visualizationMask.onerror = function() {
            changePreviousVisWidth()
        }
    }
    previousBaseWidth = b;
    previousVisWidth = c
}

function getMapVisTooltipTheme() {
    return {
        skin: "light",
        hook: "topmiddle",
        target: "mouse",
        background: {
            opacity: 1
        }
    }
}

function enhanceMapWithTooltips() {
    if (!canvasSupported) {
        return "canvas not Supported"
    }
    if (svgSupported) {
        $("#svgContainer").mousemove(mapTooltip).click(mapTooltip)
    } else {
        $("#visualization").mousemove(mapTooltip).click(mapTooltip)
    }
}
var $visualization;

function mapTooltip(c) {
    if ($("#plot").val() == "heatMap") {
        $visualization = $(this);
        var b = getHexColor(c, this);
        currentMouseOverCountry = getCountryFromColor(b);
        if (currentMouseOverCountry != "") {
            var a = getCountryMouseOverHTMLTooltip(currentMouseOverCountry);
            if (a == "") {
                removeEUMapTooltips();
                currentMouseOverCountry = ""
            }
            if (isUndefined(visTooltip) || isUndefined(visTooltip) || visTooltip == null || visTooltip.items().length == 0) {
                visTooltip = Tipped.create($visualization, a, getMapVisTooltipTheme())
            }
            $visTooltipContainer = $(visTooltip.items()[0].container).find(".t_ContentContainer");
            if (mouseOverCountry != currentMouseOverCountry || $visTooltipContainer.html() == "") {
                mouseOverCountry = currentMouseOverCountry;
                $visTooltipContainer.html(getCountryMouseOverHTMLTooltip(currentMouseOverCountry));
                if (currentMouseOverCountry == "") {
                    removeEUMapTooltips()
                } else {
                    visTooltip.items()[0].options.background.opacity = 1
                }
            }
            if (visTooltip != null) {
                visTooltip.refresh();
                visTooltip.show()
            }
        } else {
            removeEUMapTooltips()
        }
    } else {
        removeEUMapTooltips()
    }
}

function getEUMapTooltipContent(a) {
    return (getCountryMouseOverHTMLTooltip(a))
}

function isUndefined(a) {
    return typeof(a) == "undefined" || typeof a === "undefined"
}

function removeEUMapTooltips() {
    currentMouseOverCountry = "";
    if (!isUndefined(visTooltip) && visTooltip != null) {
        visTooltip.hide()
    }
}

function goToInCountry(a) {
    if ($("#plot").val() == "heatMap") {
        if (currentMouseOverCountry != "") {
            selectOptionChange("country", currentMouseOverCountry);
            selectOptionTriggerChange("plot", "inCountry");
            updateProxyPlot();
            $("#country").trigger("chosen:updated");
        }
    }
}

function updateProxyPlot() {
    $(".visualisationSelections li.selected").removeClass("selected");
    $(".visualisationSelections li [proxyPlot='" + $("#plot").val() + "']").each(function() {
        $(this).parent().addClass("selected")
    })
}

function getHexColor(g, b) {
    var j = findPos(b);
    var a = g.pageX - j.x;
    var h = g.pageY - j.y;
    var d = 1;
    if (isUndefined(maskCanvas2dContext)) {
        return ""
    }
    var f = maskCanvas2dContext.getImageData(a * d, h, 1, 1).data;
    var c = ("000000" + rgbToHex(f[0], f[1], f[2])).slice(-6);
    return c
}

function getCountryMouseOverHTMLTooltip(g) {
	
    if ($("#plot").val() != "heatMap" || heatMapTooltips == null || isUndefined(heatMapTooltips)) {
        return (g)
    }
    if (g == "") {
        return g
    }
    var a = "";
    var f = "";
    var d = 0;
	
    for (var c = 0; c < heatMapTooltips.length; c++) {
		
        var e = heatMapTooltips[c];
        if (e[0] == g) {
            d++;
            if (f == "") {
                f = e[1]
            }
            var b = (e[2] == $("#answer option:selected").text());
            a = a + "<li>" + e[2] + " : " + (b ? "[" : "") + e[3] + (b ? "]" : "") + " % </li>\t"
        } else {
            if (f != "") {
                break
            }
        }
    }
    if (d == 1) {
        a = a.replace(/[\%]/g, "")
    }
    if (a.length == "") {
        removeEUMapTooltips();
        return ""
    }
    return "<a href='javascript:goToInCountry()' style='color:black!important' ><h4><img src='/DVS/DVT/garnish/arrowRight.png'/> " + f + "</h4><hr/><ul>" + a + "</ul></a>"
}
var svgOriginalWidth = 740;
var svgOriginalHeight = 740;
var svgResponsiveHeight = 740;
var resolveCountries = false;
var alertFill = false;
var colorsToIgnore = ["rgb(255, 255, 255)", "rgb(242, 242, 242)", "none", "#ffffff", "#39a935", "black", "#000000", "rgb(53.333333%,61.176471%,75.686275%)", "rgb(0, 0, 0)"];
//var colorsToIgnore = ["rgb(255, 255, 255)", "none", "#ffffff", "#39a935", "black", "#000000", "rgb(53.333333%,61.176471%,75.686275%)", "rgb(0, 0, 0)"];
var requestedVisualizationUrl = "";
var isFirst = true;
var DVSPalletHex = ["#A7BD43", "#7FADBA", "#DCAB5D", "#E5DCBB", "#C5C8BF", "#92A8B4", "#CF9173", "#E4D6A3"];
var DVSPalletRGB = ["rgb(167, 189, 67)", "rgb(127, 173, 186)", "rgb(220, 171, 93)", "rgb(229, 220, 187)", "rgb(197, 200, 191)", "rgb(146, 168, 180)", "rgb(207, 145, 115)", "rgb(228, 214, 163)"];

function getGroupIndexByColor(b) {
    for (var a = 0; a < DVSPalletHex.length; a++) {
        if (b == DVSPalletHex[a].toLowerCase() || b == DVSPalletRGB[a]) {
            return a
        }
    }
    return -1
}
var previousLink = "";

function updateSVG() {
    var a = $("#svgExport").attr("href");
    if (a == previousLink) {
        return "same requestLink"
    }
    setTimeout(surfaceFadeOut, 10);
    previousLink = a;
    if (!isFirst) {
        $("#loadingVisualizationSection").css("opacity", 0).removeClass("inv").css("opacity", 0).css("display", "block").find("svg").css("display", "block").css("width", "96%").css("height", "auto").css("height", widthState == 3 ? "60%" : "80%").parent().fadeTo("fast", 1);
        stopvibrateLoading = false;
        vibrateLoading()
    }
    $.ajax({
        url: a,
        success: function(b) {
            if (b.length < 100) {
                return
            }
            if (requestedVisualizationUrl == (a + "visited")) {
                setTimeout(removeLoading, 200);
                return
            }
            requestedVisualizationUrl = a + "visited";
            $svgContainer = $("#svgContainer");
            $visualization = $("#visualization");
            $svgContainer.html(b);
            $svgContainerSvg = $svgContainer.find("svg");
            $svgContainerSvg.css("display", "none");
            $svgContainerSvg.css("display", "block");
            svgOriginalWidth = parseFloat($svgContainerSvg.attr("width").replace("pt", ""));
            svgOriginalHeight = parseFloat($svgContainerSvg.attr("height").replace("pt", ""));
            enhanceSVG();
            isFirst = false
        },
        error: function(d, b, c) {}
    });
    setTimeout(checkSVGContent, 5000)
}

function fadeLoadingVisualizationSection() {
    $("#loadingVisualizationSection").fadeTo("slow", 0);
    $("#loadingVisualizationSection svg").fadeTo("slow", 0);
    setTimeout(hideLoadingVisualizationSection, 1600)
}

function hideLoadingVisualizationSection() {
    $("#loadingVisualizationSection").css("display", "none")
}
var stopvibrateLoading = false;

function removeLoading() {
    stopvibrateLoading = true;
    fadeLoadingVisualizationSection()
}

function vibrateLoading() {
    if (!stopvibrateLoading) {
        jQuery("#loadingVisualizationSection svg").each(function() {
            if (!stopvibrateLoading) {
                jQuery(this).fadeTo("slow", 0.6, function() {
                    if (!stopvibrateLoading) {
                        jQuery(this).fadeTo("slow", 1, function() {
                            vibrateLoading()
                        })
                    } else {
                        jQuery(this).fadeTo("slow", 0)
                    }
                })
            } else {
                jQuery(this).fadeTo("slow", 0)
            }
        })
    }
}

function checkSVGContent() {
    if ($("#svgContainer").html().length == 0) {
        updateSVG()
    }
}

function calculateResponsiveHeightForAndroid() {
    $svgContainerSvg = $("#svgContainer svg");
    var a = $svgContainerSvg.width();
    if (a != null) {
        if (a != 100) {
            svgResponsiveHeight = (a / svgOriginalWidth) * svgOriginalHeight;
            setTimeout(resizeSVGforAndroid, 100)
        }
    } else {
        setTimeout(calculateResponsiveHeightForAndroid, 200)
    }
}

function resizeSVGforAndroid() {
    $("#svgContainer svg").css("height", svgResponsiveHeight);
    $("#svgContainer svg").css("left", "0px");
    $("#svgContainer svg").css("margin-left", "0px");
    setTimeout(updateMaskMap, 1220)
}

function enhanceSVG() {
    $visualization = $("#visualization");
    $svgContainer = $("#svgContainer");
    $svgContainer.css("opacity", 0);
    $svgContainerSvg = $svgContainer.find("svg");
    $svgContainerSvg.css("width", "100%");
    $svgContainerSvg.css("height", "auto");
    $svgContainerSvg.css("height", "100%");
    calculateResponsiveHeightForAndroid();
    makePathInteractive();
    setTimeout(changePreviousVisWidth, 900);
    setTimeout(removeLoading, 800);
    setTimeout(surfaceMapBodyFadeIn, 1000)
}

function swapWithSVGContainer() {
    $("#media").val("svg");
    $("#svgContainer").removeClass("hidden");
    $("#visualization").addClass("inv")
}
var surfaceChilds;
var surfaceChildIndex = 1;

function surfaceMapBodyFadeIn() {
    var a = 30;
    var b = $("#plot").val();
    if (b == "inCountry") {
        a = 20
    }
    if (b == "crossCountry") {
        a = 40
    }
    if (b == "heatMap") {
        a = 60
    }
    fadeChildrenOf("#svgContainer g[id*='surface']", a);
    $("#svgContainer").css("opacity", 1)
}

function fadeChildrenOf(b, c) {
    $surface = $(b);
    surfaceChilds = $surface.children();
    surfaceChilds.css("opacity", 0);
    surfaceChildIndex = 0;
    surfaceChildrenCount = surfaceChilds.length;
    for (var a = 0; a <= surfaceChildrenCount; a++) {
        setTimeout(function() {
            surfaceChildIndex++;
            $(surfaceChilds[surfaceChildIndex]).fadeTo("slow", 1)
        }, a * c)
    }
}

function surfaceFadeOut() {
    $surface = $("#surface0");
    surfaceChilds = $surface.children();
    surfaceChildIndex = surfaceChilds.length - 2;
    var b = 30;
    if ($("#plot").val() == "inCountry") {
        b = 10
    }
    for (var a = surfaceChildIndex + 1; a >= 0; a--) {
        setTimeout(function() {
            surfaceChildIndex--;
            $(surfaceChilds[surfaceChildIndex]).fadeTo("slow", 0)
        }, a * b)
    }
}

function makePathInteractive() {
    var a = "#svgContainer path";
    $(a).mouseenter(function(h) {
        $this = $(this);
        var j = $("#plot").val();
        var m = $this.css("fill");
        for (var g = 0; g < colorsToIgnore.length; g++) {
            if (colorsToIgnore[g] == m) {
              return "ignore color"
		    }
        }
		var c = $this.attr("d").substring(0, 21);
		
        if (alertFill) {
            alert(m)
        }
        $elementsOfSameStyle = $this;
        var d = $elementsOfSameStyle.attr("class");
        var b = false;
        if (j == "heatMap") {
			//alert("m: " + m);
            if (m == "rgb(26, 26, 26)" || m == "#1a1a1a") {
                b = true;
                currentMouseOverCountry = "MT"
            } else {
                currentMouseOverCountry = getCountryForPath(c)
				//alert(currentMouseOverCountry);
            }
            Tipped.create($this, function(e) {
                return getCountryMouseOverHTMLTooltip(currentMouseOverCountry)
            }, getMapVisTooltipTheme());
			
			if (currentMouseOverCountry == ""){
				//currentMouseOverCountry = "NO";
			}
            var f = currentMouseOverCountry
			
        }
        var k = $this.attr("class");
        if (resolveCountries || j == "inCountry" || j == "subsetTimeSeries") {
            $elementsOfSameStyle = $("[class='" + k + "']")
        }
        if (j == "subsetTimeSeries") {
            Tipped.create($this, function(o) {
                var s = getGroupIndexByColor(m);
                if (s != -1) {
                    var q = $this.prev();
                    var n = 0;
                    var p = $this.css("fill");
                    while (q.length != 0) {
                        if (q.css("fill") != p) {
                            break
                        }
                        n++;
                        q = q.prev()
                    }
                    var e = uniqueArrayTableBy(csvDataArray, 3)[s];
                    var r = orderArrayTableBy(indexTable(filterArrayTableBy(csvDataArray, 3, e)), 5, 1)[n];
                    var t = getSelectOptionTextBySanitizedKey("#answer", r[4]);
                    return "<h3>" + getSelectOptionTextByKey("#country", r[1]) + " - " + r[0] + "</h3><div>Subset: " + getSelectOptionTextBySanitizedKey("#subsetValue", r[3]) + "</div><div> Answer: " + t + "</div><h1>" + r[5] + "</h1>"
                }
            }, getMapVisTooltipTheme())
        }
        if (j != "euMatrix") {
            if (!b) {
                $elementsOfSameStyle.attr("class", "visualizationElementHighlighted")
            }
        }
        $this.mouseleave(function() {
            $elementsOfSameStyle.attr("class", d);
            if (j == "euMatrix") {
                positionHorizontalHair("#horizontalHair", "-1");
                positionVerticalHair("#verticalHair", "-1")
            }
        });
        if (resolveCountries) {
            $this.click(function(p) {
                alert($elementsOfSameStyle.length);
                var o = "";
                for (var n = 0; n < $elementsOfSameStyle.length; n++) {
                    o += "\n" + currentMouseOverCountry + "\t" + $($elementsOfSameStyle[n]).attr("d").substring(0, 21)
                }
                alert(o)
            })
        }
        if (j == "euMatrix") {
            var l = getPathMidXY($this);
            positionHorizontalHair("#horizontalHair", l[0]);
            positionVerticalHair("#verticalHair", l[1])
        }
    })
}

function makeTextInteracrive() {
    var a = "use";
    $(a).mouseenter(function() {
        $this = $(this);
        $elementsOfSameStyle = $("[style='" + $this.parent().attr("style") + "']");
        $elementsOfSameStyle.css("fill-opacity", 0.5);
        $this.mouseleave(function() {
            $elementsOfSameStyle.css("fill-opacity", 1)
        })
    })
}

function getSelectOptionTextBySanitizedKey(a, b) {
    return getSelectOptionTextByKey(a, b.replace(/[^a-zA-Z0-9]/g, "-"))
}

function getSelectOptionTextByKey(b, d) {
    var a = $(b + " option");
    for (var c = 0; c <= a.length; c++) {
        if ($(a[c]).val() == d) {
            return $(a[c]).text()
        }
    }
    return "Unknown"
}
var csvDataArray = [];

function invertArrayTable(a) {
    return a[0].map(function(b, c) {
        return a.map(function(d) {
            return d[c]
        })
    })
}

function updateTooltipsJs() {
    if (!svgSupported) {
        return false
    }
    if ($("#plot").val() == "heatMap") {
        $.getScript("/DVS/render/plots/js/" + getPlotBodyFileName() + ".js").done(function(a, b) {}).fail(function(c, b, a) {})
    }
    if ($("#plot").val() == "subsetTimeSeries") {
        $.get($("#csvExport").attr("href"), function(b) {
            dataRows = b.replace(/\"/g, "").replace(/\n$/g, "").split("\n");
            var a = [];
            for (var c = 0; c < dataRows.length; c++) {
                if (c > 0) {
                    a[c - 1] = dataRows[c].split("\t")
                }
            }
            csvDataArray = a
        })
    }
}

function positionHorizontalHair(a, b) {
    a = $(a);
    a.attr("x1", "0%");
    a.attr("x2", "100%");
    a.attr("y1", b);
    a.attr("y2", b)
}

function positionVerticalHair(b, a) {
    b = $(b);
    b.attr("y1", "0%");
    b.attr("y2", "100%");
    b.attr("x1", a);
    b.attr("x2", a)
}

function getPathMidXY(a) {
    var b = getPathMinMaxXY(a);
    return [(b[0] + b[1]) / 2, (b[2] + b[3]) / 2]
}

function getPathMinMaxXY(d) {
    var g = $(d).attr("d").split(" ");
    var b = [];
    for (var c = 0; c < g.length; c++) {
        if (!isNaN(parseFloat(g[c]))) {
            b[b.length] = parseFloat(g[c])
        }
    }
    var a = 1000;
    var f = 0;
    var h = 1000;
    var e = 0;
    for (var c = 0; c < b.length; c++) {
        if (c % 2 == 0) {
            if (b[c] < h) {
                h = b[c]
            }
            if (b[c] > e) {
                e = b[c]
            }
        } else {
            if (b[c] < a) {
                a = b[c]
            }
            if (b[c] > f) {
                f = b[c]
            }
        }
    }
    return [a, f, h, e]
}

function getCountryForPath(a) {
    var b = 740;
    if (widthState == 2) {
        b = 740
    }
    if (widthState == 1) {
        b = 920
    }
    if (widthState == 3) {
        b = 500
    }
	
    for (i = 0; i < countryToPathD.length; i++) {
        if (a.indexOf(countryToPathD[i][1]) != -1) {
            return countryToPathD[i][0]
        }
    }
    return ""
}
var canvasSupported = false;
var svgSupported = false;
var plotSelectionTooltipOn = false;
var hadUrlParameters = false;
var isInitialized = false;

function supportsCanvas() {
    return resolveCountries
}

function supportsSvg() {
    var b = document.createElement("div");
    b.innerHTML = "<svg></svg>";
    var a = b.firstChild && "namespaceURI" in b.firstChild && b.firstChild.namespaceURI == "http://www.w3.org/2000/svg";
    return a
}
$(function() {
    canvasSupported = supportsCanvas();
    if (supportsSvg() == true) {
        svgSupported = true;
        $("#visualization").addClass("inv").remove();
        $.ajax({
            url: server + "/DVS/DVT/img/loading-animation.svg",
            dataType: "text",
            success: function(c) {
                $("#loadingVisualizationSection").html(c).removeClass("inv")
            },
            error: function(e, c, d) {}
        })
    } else {
        $("#loadingVisualizationSection").removeClass("inv").html("<img id='gifLoadingAnimation' src='img/loading-animation.gif' title='Loading...' width='740px' height='740px' />")
    }
    $(".secondary").addClass("hidden");
    if ($(window).width() < 805) {
        $("#leftColumn").addClass("hidden")
    } else {
        if ($("#leftColumn").length == 0) {
            $(".questionSection").removeClass("hidden")
        }
    }
    var b = "";
    for (var a = primaryVisualizationUpto; a < plotFilesParameters.length / 2; a++) {
        $proxyPlot = $("#proxy_plot_label" + a);
        $proxyPlot.addClass("secondary");
        $proxyPlot.addClass("hidden")
    }
    isInitialized = false;
    if (window.location.search.indexOf("?") != -1) {
        hadUrlParameters = true
    } else {
        hadUrlParameters = false
    }
    loadSelectValues($("#subset")[0], subset_);
    initLinkedSelect($("#subset")[0], $("#subsetValue")[0], subset_subsetValue);
    loadSelectValues($("#topic")[0], topic_);
    loadOptGroupSelectValues($("#question")[0], topic_question);
    initLinkedSelect($("#question")[0], $("#answer")[0], question_answer);
    loadSelectValues($("#country")[0], country_);
    loadInverseSelectValues($("#countryB")[0], country_);
    onChangeUpdateVisualization($("#plot"));
    onChangeUpdateVisualization($("#question"));
    onChangeUpdateVisualization($("#subset"));
    onChangeUpdateVisualization($("#subsetValue"));
    onChangeUpdateVisualization($("#answer"));
    onChangeUpdateVisualization($("#country"));
    onChangeUpdateVisualization($("#countryB"));
    $("#plot").change(function() {
        visualizationFunctionChange(this)
    });
    $("#locale").change(function() {
        window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"))
    });
    $("#plot").trigger("change");
    $("#prevQuest, .prevQuest").click(function() {
        prevQuestion()
    });
    $("#nextQuest, .nextQuest").click(function() {
        nextQuestion()
    });
    Tipped.create($("#prevQuest"), function(f) {
        var d = $("#question")[0];
        var g = d.selectedIndex;
        var c = d.length;
        var e = d[g > 0 ? g - 1 : c - 1].text;
        if (e.length == 0) {
            e = d[c - 1].text
        }
        return e
    }, getTopTooltipSkin());
    Tipped.create($(".prevQuest"), function(f) {
        var d = $("#question")[0];
        var g = d.selectedIndex;
        var c = d.length;
        var e = d[g > 0 ? g - 1 : c - 1].text;
        if (e.length == 0) {
            e = d[c - 1].text
        }
        return e
    }, getTopTooltipSkin());
    Tipped.create($("#nextQuest"), function(e) {
        var d = $("#question")[0];
        var f = d.selectedIndex;
        var c = d.length;
        var g = d[f < c - 1 ? f + 1 : 0].text;
        if (g.length == 0) {
            g = d[1].text
        }
        return g
    }, getTopTooltipSkin());
    Tipped.create($(".nextQuest"), function(e) {
        var d = $("#question")[0];
        var f = d.selectedIndex;
        var c = d.length;
        var g = d[f < c - 1 ? f + 1 : 0].text;
        if (g.length == 0) {
            g = d[1].text
        }
        return g
    }, getTopTooltipSkin());
    $("#moreVisualizations span").click(function() {
        var d = $(this).parent();
        d.toggleClass("checked");
        var c = d.find("span");
        if (d.hasClass("checked")) {
            c.text(c.attr("pressed"))
        } else {
            c.text(c.attr("unpressed"))
        }
        $(".secondary").toggleClass("hidden")
    });
    $("#csvView").click(function() {
        if ($(this).is(":checked")) {
            viewVisualizationData()
        } else {
            swapVisualizationData()
        }
    });
    $("#onlyEU").click(function() {
        updateVisualization()
    });
    dialogInit();
    dialogURLInit();
    $("#toolUrlExport, #toolUrlExportProxy").click(function(c) {
        $("#dialogContentURL").text($("#toolUrlExport").attr("href")).dialog("open").dialog("option", "title", toCopy + ": " + $(this).text());
        $("#dialogContentURL").selectText();
        c.preventDefault()
    });
    $("#htmlExport, #htmlExportProxy").click(function(c) {
        $("#dialogContent").text(getVisualizationHTML()).dialog("open").dialog("option", "title", toCopy + ": " + $(this).text());
        $("#dialogContent").selectText();
        c.preventDefault()
    });
    $("#citeExport, #citeExportProxy").click(function(c) {
        $("#dialogContent").text(getVisualizationCiteReference()).dialog("open").dialog("option", "title", toCopy + ": " + $(this).text());
        $("#dialogContent").selectText();
        c.preventDefault()
    });
    $("#label_csvView, #label_onlyEU").click(function(c) {
        $this = $(this);
        $thisInput = $this.find("input");
        $thisInput.prop(!$thisInput.prop("checked"));
        $this.removeClass("checked");
        if ($thisInput.is(":checked")) {
            $this.addClass("checked")
        }
    });
    responsiveVisualizationSelection();
    selectElementsBasedOnUrl();
    updateVisualizationDepedencies();
    tooltipEnhancements();
    setTimeout(responsiveAutoArrange, 1300);
    setTimeout(changePreviousVisWidth, 1200);
    setTimeout(changePreviousVisWidth, 4200);
    initResizeDetection();
    setTimeout(updateMediaBasedOnWidth, 2000);
    enhanceMapWithTooltips();
    $("#formatSelectorTooltips a").click(function(c) {
        $($(this).attr("src")).click()
    });
    $("a.proxyable").each(function() {
        $this = $(this);
        $this.click(function(c) {
            $this = $(this);
            $targetElement = $($this.attr("src"));
            $targetElement.prop("checked", !$targetElement.prop("checked"));
            targetElementIsChecked = $targetElement.prop("checked");
            isCsvView = $this.attr("src") == "#csvView";
            if (isCsvView) {
                $this = $this.parent()
            }
            $this.removeClass("selected");
            if (targetElementIsChecked) {
                $this.addClass("selected")
            }
            if (isCsvView) {
                if (targetElementIsChecked) {
                    viewVisualizationData()
                } else {
                    swapVisualizationData()
                }
            } else {
                updateVisualization()
            }
        })
    });
    setTimeout(selectAQuestion, 1600)
});

function selectAQuestion() {
    if ($("#question").find(":selected").val() == "") {
        nextQuestion()
    }
    $("div#leftmenu, article").css("opacity", 1)
}

function dialogInit() {
    $("#dialogContent").dialog({
        autoOpen: false,
        width: 400,
        buttons: [{
            text: selectContent,
            click: function() {
                $("#dialogContent").selectText()
            }
        }, {
            text: ok,
            click: function() {
                $(this).dialog("close")
            }
        }]
    })
}

function dialogURLInit() {
    $("#dialogContentURL").dialog({
        autoOpen: false,
        width: 400,
        buttons: [{
            text: selectContent,
            click: function() {
                $("#dialogContentURL").selectText()
            }
        }, {
            text: visitURL,
            click: function() {
                window.location.href = $("#toolUrlExport").attr("href")
            }
        }, {
            text: ok,
            click: function() {
                $(this).dialog("close")
            }
        }]
    })
}
jQuery.fn.selectText = function() {
    var d = document,
        b = this[0],
        a, c;
    if (d.body.createTextRange) {
        a = document.body.createTextRange();
        a.moveToElementText(b);
        a.select()
    } else {
        if (window.getSelection) {
            c = window.getSelection();
            a = document.createRange();
            a.selectNodeContents(b);
            c.removeAllRanges();
            c.addRange(a)
        }
    }
};

function getBaseUrl() {
    return location.protocol + "//" + location.hostname + (location.port ? ":" + location.port : "")
}

function getVisualizationHTML() {
    var a = $("#pngExport").first().attr("href");
    a = a.substring(0, a.indexOf("&down"));
    return "<section>\n	<a href='" + $("#toolUrlExport").attr("href") + "'>\n		<img src='" + getBaseUrl() + a + "'/>\n	</a>\n	<p>" + $(".freetext p").text().trim() + "</p>\n</section>"
}

function getVisualizationCiteReference() {
    return "@ONLINE{OSHA:2015:Online,\n	author = {" + $("header h1").text().replace("\\t", "").trim() + "},\n	title = {" + getVisualizationTitle() + "},\n	year = {2012},\n	url = {" + $("#toolUrlExport").attr("href") + "}\n}"
}

function tooltipEnhancements() {
    Tipped.create(".buttom-tooltip", getButtomTooltipSkin());
    Tipped.create(".side-tooltip", getSideTooltipSkin());
    Tipped.create(".top-tooltip", getTopTooltipSkin());
    var a = $(".exportOptions h2").html();
    var d = $(".exportOptions a");
    for (var b = 0; b < d.length; b++) {
        var c = $(d[b]);
        c.find("img").attr("src", server + "/DVS/DVT/garnish/" + c.attr("id") + ".png");
        exportLinkTitle = a + " > " + c.text();
        c.attr("title", exportLinkTitle)
    }
    Tipped.create(".exportOptions a", getButtomTooltipSkin());
    for (var b = 0; b < plotFilesParameters.length; b++) {
        Tipped.create("#proxy_plot_label" + b, "plotSelectionTooltip" + b, getPlotSelectionTooltipSkin())
    }
    Tipped.create("#moreVisualizations", "moreVisualizationsTooltip", getPlotSelectionTooltipSkin());
    Tipped.create("#label_csvView", "tableViewTooltip", getPlotSelectionTooltipSkin());
    Tipped.create("#label_onlyEU", "onlyEUTooltip", getPlotSelectionTooltipSkin())
}

function getButtomTooltipSkin() {
    return {
        skin: "light",
        hook: "bottomleft",
        target: "mouse",
        maxWidth: 185,
        closeButtonSkin: "white",
        closeButton: true
    }
}

function getSideTooltipSkin() {
    return {
        skin: "light",
        hook: "rightmiddle",
        target: "mouse",
        maxWidth: 185,
        closeButtonSkin: "white",
        closeButton: true
    }
}

function getPlotSelectionTooltipSkin() {
    return {
        skin: "light",
        hook: "bottomleft",
        target: "mouse",
        maxWidth: 200,
        inline: true,
        closeButtonSkin: "white",
        closeButton: true,
        onShow: function(b, a) {
            plotSelectionTooltipOn = true;
            if ($window.height() < 700) {
                $(".plotSelectionTooltip img").addClass("hidden");
                plotSelectionTooltipOn = false
            } else {
                $(".plotSelectionTooltip img").removeClass("hidden")
            }
            Tipped.refresh(a)
        },
        onHide: function(b, a) {
            plotSelectionTooltipOn = false
        }
    }
}

function getTopTooltipSkin() {
    return {
        skin: "light",
        hook: "topright",
        target: "mouse",
        maxWidth: 185,
        closeButtonSkin: "white",
        closeButton: true
    }
}

function getTopLeftTooltipSkin() {
    return {
        skin: "light",
        hook: "topleft",
        target: "mouse",
        maxWidth: 185,
        closeButtonSkin: "white",
        closeButton: true
    }
}

function responsiveVisualizationSelection() {
    var b = $("#plot")[0];
    for (var a = 0; a < b.options.length; a++) {
        $(".proxy_plot_leftlabel" + a).click(function() {
            $this = $(this);
            $(".visualisationSelections li.selected").removeClass("selected");
            $this.parent().addClass("selected");
            var c = $this.attr("proxyPlot");
            selectOptionTriggerChange("plot", c)
        })
    }
}

function createResponsiveProxyLinksFromSelect(g, e, f, a) {
    $from = $(g);
    $from.addClass("hidden");
    $nextTo = $(e);
    var d = "<div id='" + f + "' style='margin:0px;'>";
    if (a) {
        d += "<strong>" + $from.attr("title") + "</strong>"
    }
    d += "<ul>";
    var c = $("#" + $from.attr("id") + " option:selected").val();
    for (var b = 0; b < g.options.length; b++) {
        d += "<li " + (c == g.options[b].value ? " class='current' " : "") + "><a href='#' title='" + g.options[b].text + "' class='buttom-tooltip' rel='" + g.options[b].value + "' >" + g.options[b].value.toLowerCase() + "</a></li>"
    }
    d += "</ul></div>";
    $nextTo.parent().append(d);
    $("#" + f + " ul li a").click(function() {
        $from.val($(this).attr("rel")).attr("selected", true);
        $from.trigger("change")
    })
};

function removeCountrys(){
	
	$("#country_chosen").click(function(){
	   if (($("#plot").val()) == 'inCountry' && By == 'Sectorgrp'){
			$("li[data-option-array-index=0]").hide();
			$("li[data-option-array-index=1]").hide();
			$("li[data-option-array-index=2]").hide();
			$("li[data-option-array-index=4]").hide();
			$("li[data-option-array-index=5]").hide();
			$("li[data-option-array-index=14]").hide();
			$("li[data-option-array-index=16]").hide();
			$("li[data-option-array-index=19]").hide();
			$("li[data-option-array-index=20]").hide();
			$("li[data-option-array-index=22]").hide();
			$("li[data-option-array-index=23]").hide();
			$("li[data-option-array-index=24]").hide();
			$("li[data-option-array-index=26]").hide();
			$("li[data-option-array-index=30]").hide();
			$("li[data-option-array-index=31]").hide();
			
		}
	});
}
//Countrys without data for some questions**********
function removeCountrys2(){
	
	if($("#country_chosen").length>0) {
		
		$("#country_chosen").click(function(){
			
			
			if (questionid=='Q166_1' && $("#plot").val() == 'inCountry'){	
				$("li[data-option-array-index=3]").hide();
				$("li[data-option-array-index=5]").hide();
				$("li[data-option-array-index=9]").hide();
				$("li[data-option-array-index=23]").hide();
				$("li[data-option-array-index=31]").hide();
			}	
			
			if (questionid=='Q166_2' && $("#plot").val() == 'inCountry'){	
				$("li[data-option-array-index=1]").hide();
				$("li[data-option-array-index=7]").hide();
				$("li[data-option-array-index=20]").hide();
			}	
			
			if (questionid=='Q166_4' && $("#plot").val() == 'inCountry'){	
				$("li[data-option-array-index=23]").hide();
				$("li[data-option-array-index=32]").hide();
			}
			
			if (questionid=='Q256_3' && $("#plot").val() == 'inCountry'){	
				
				$("li[data-option-array-index=3]").hide();
				$("li[data-option-array-index=5]").hide();
				$("li[data-option-array-index=9]").hide();
				$("li[data-option-array-index=23]").hide();
				$("li[data-option-array-index=31]").hide();
			}
			
			if (questionid=='Q256_4' && $("#plot").val() == 'inCountry'){	
				$("li[data-option-array-index=1]").hide();
				$("li[data-option-array-index=7]").hide();
				$("li[data-option-array-index=20]").hide();
			}
		
		
			if (questionid=='MM303a' && $("#plot").val() == 'inCountry'){
				$("li[data-option-array-index=4]").hide();//CY
				$("li[data-option-array-index=8]").hide();//EE
				$("li[data-option-array-index=20]").hide();//MT
			}
			
			if (questionid=='MM350' && $("#plot").val() == 'inCountry'){
				$("li[data-option-array-index=4]").hide();//CY
				$("li[data-option-array-index=20]").hide();//MT
				$("li[data-option-array-index=26]").hide();//SE
			}
			if (questionid=='MM351'  && $("#plot").val() == 'crossCountry'){
				c1 =  $("#country option:selected").val();
				c2 =  $("#countryB option:selected").val();
				
				
				if ( c1=="AT" || c2=="AT" || c1=="DE" || c2 == "DE"||  c1=="LU" || c2 == "LU"){
					alert(alertnotdis);
					jQuery("#country option:eq(1)").attr("selected","selected");	
					$("#country_chosen a span").text($("#country option:eq(1)").text());
					jQuery("#countryB option:eq(0)").attr("selected","selected");
					$("#countryB_chosen a span").text($("#countryB option:eq(0)").text());
					//window.location = window.location.pathname + "?" + getFormParameters($("#graphControlsForm"));
				}
				
			}
			if (questionid=='MM351' && $("#plot").val() == 'inCountry'){
				$("li[data-option-array-index=0]").hide();//AT
				$("li[data-option-array-index=6]").hide();//DE
				$("li[data-option-array-index=18]").hide();//LU
			}
			
			if (questionid=='MM355all' && $("#plot").val() == 'inCountry'){
				$("li[data-option-array-index=3]").hide();//CH
			}
			
			if (questionid=='MM358' && $("#plot").val() == 'inCountry'){
				$("li[data-option-array-index=18]").hide();//LU
				$("li[data-option-array-index=27]").hide();//SI
			}	
					
		});
	} else {
	 setTimeout("removeCountrys2()",1000);
	}
}
