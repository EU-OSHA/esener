var selectedElement;var getFileSize=function(b){var a=b.length/1000;if(a>1000){return(Math.round(a/100)/10)+" MB"}else{return(Math.round(a*10)/10)+" kB"}};var drawSVG=function(a,f){var g="#"+a;var h=jQuery(g);var d=jQuery(g+"-wrapper");var e=h.css("width").slice(0,-2);d.empty();jQuery(f).each(function(j){this.toJQueryObject(d)});h.html(h.html());var b=function(){var l=jQuery(g+"-wrapper")[0].getBBox();if(l.width>0){var m,j,i;if(l.width>l.height){m=(e-10)/l.width;j=-l.x;i=-l.y+0.5*(l.width-l.height)}else{m=(e-10)/l.height;j=-l.x+0.5*(l.height-l.width);i=-l.y}var k="translate(5 5) scale("+m+") translate("+j+" "+i+")";document.getElementById(a+"-transform").setAttributeNS(null,"transform",k)}};var c=window.setTimeout(b,100);return jQuery(g+"-wrapper")[0].getBBox()};var loadWindow=function(c){var d=["input","optimise","edit","output"];for(var a in d){var b=d[a];if(c==b){jQuery("#"+b+"-area").show();jQuery("#toolbar-"+b).addClass("selected")}else{jQuery("#"+b+"-area").hide();jQuery("#toolbar-"+b).removeClass("selected")}}if(c==="edit"){drawSVG("full-svg",svg_tree.root.children)}};var selectElement=function(g){var d=svg_tree.id_to_element[g];var a=jQuery("#map-"+g);selectedElement=d;displayElementDetails(d);if(a.length===1){var f=jQuery("#svg-tree").scrollTop()-a.position().top;jQuery("#svg-tree").animate({scrollTop:a.position().top},"fast")}jQuery(".svg-element-div").removeClass("selected");a.addClass("selected");var c=drawSVG("sub-svg",[d]);var b=document.getElementById("highlight-rect");b.setAttributeNS(null,"x",c.x-1);b.setAttributeNS(null,"y",c.y-1);b.setAttributeNS(null,"width",c.width+2);b.setAttributeNS(null,"height",c.height+2);b.setAttributeNS(null,"visibility","visible");var e=jQuery("#full-svg");e.html(e.html())};var writeElementDetailList=function(a,c,d){var i=d.tree.attrDecimals;var b=jQuery("#element-"+a);b.empty();var f=jQuery("<h3></h3>");b.append(f);var e=0;if(c){var j=jQuery("<table></table>");for(var h in c){var k=jQuery("<tr></tr>");k.append(jQuery("<td>"+h+"</td>"));var g=(d.tag==="path"&&h==="d")?d.getPathString(i):i(c[h]);k.append(jQuery("<td>"+g+"</td>"));j.append(k);e++}b.append(j)}f.text(a+" ("+e+")")};var displayElementDetails=function(e){var d=jQuery("#breadcrumbs");d.empty();for(var f in e.parents){var g=jQuery("<span>"+e.parents[f].writeLabel()+"</span>");var c=e.parents[f].id;g.on("click",function(i){selectElement(c)});d.append(g)}d.append(jQuery('<span class="selected">'+e.writeLabel()+"</span>"));writeElementDetailList("attributes",e.getUsedAttributes(),e);var b=jQuery("#element-data");b.empty();if(e.data!==""){b.append(jQuery("<h3>Data</h3>"));b.append(jQuery("<div>"+e.data+"</div>"))}var j={};var h=e.getUsedStyles();for(var k in h){var a=h[k].split(":");j[a[0]]=a[1]}writeElementDetailList("styles",j,e)};var removeHighlight=function(a){var b=document.getElementById("highlight-rect");b.setAttributeNS(null,"visibility","hidden")};var handleCodeClick=function(a){a.stopPropagation();var b=jQuery(this).attr("id").slice(4);selectElement(b)};var updateOutputCode=function(){var e=svg_tree.toString();var b=getFileSize(e);var a=Math.round(1000*e.length/svg_tree.svg_string.length)/10;jQuery("#optimised-file-size").text(b+" ("+a+"%)");jQuery("#output-svg-code").text(e);jQuery("#svg-string-form").val(e);var d=jQuery("#optimised-svg-wrapper");var c=jQuery('<div id="optimised-svg">'+e+"</div>");d.empty();d.append(c);if(selectedElement){displayElementDetails(selectedElement)}};var namespaceCheckboxes=function(){var a=jQuery("#remove-namespaces .optimise-options");a.empty();a.append(jQuery('<input type="checkbox" id="remove-all-namespaces"/>Remove all<br/>'));var c=0;for(var b in svg_tree.namespaces){if(b!=="svg"){a.append(jQuery('<input type="checkbox" class="remove-namespace" name="'+b+'"/>'+b+"<br/>"));c++}}if(c>0){jQuery(".remove-namespace").change(function(d){svg_tree.namespaces[this.name]=!this.checked;updateOutputCode()});jQuery("#remove-all-namespaces").change(function(d){jQuery(".remove-namespace").prop("checked",this.checked).trigger("change")})}else{jQuery("#remove-namespaces").hide()}};var styleCheckboxes=function(e,b){var a=jQuery("#remove-"+e+" .optimise-options");a.empty();var h=jQuery("<p></p>");a.append(h);a.append(jQuery('<input type="checkbox" id="remove-all-'+e+'">Remove all<br/>'));var g=0;for(var d in svg_tree.styles){var f=d.split(":");if(b(f[0],f[1])){var c=f[0]+": "+f[1]+" ("+svg_tree.styles[d].count+")";a.append(jQuery('<input type="checkbox" class="remove-'+e+'" name="'+d+'"/>'+c+"<br/>"));g+=svg_tree.styles[d].count}}if(g>0){h.html(e.replace("-"," ")+" ("+g+")");jQuery(".remove-"+e).change(function(i){if(svg_tree.styles[this.name]){svg_tree.styles[this.name].display=!this.checked}updateOutputCode()});jQuery("#remove-all-"+e).change(function(i){jQuery(".remove-"+e).prop("checked",this.checked).trigger("change")})}else{jQuery("#remove-"+e).hide()}};var loadSVG=function(b){svg_tree=new SVG_Tree(b);selectedElement=undefined;var a=jQuery("#svg-tree");a.empty();svg_tree.root.createMap(a);jQuery(".svg-element-div").hover(function(c){jQuery(".svg-element-div").removeClass("highlight");jQuery(this).addClass("highlight");c.stopPropagation()},function(c){jQuery(this).removeClass("highlight")});jQuery(".svg-element-div").click(handleCodeClick);jQuery("#original-file-size").text(getFileSize(svg_tree.svg_string));jQuery('input:radio[name="optimisation"]').filter('[value="None"]').prop("checked",true);selectOptionSet("None");namespaceCheckboxes();styleCheckboxes("default-styles",function(d,c){return defaultStyles[d]===c});styleCheckboxes("nonessential-styles",function(d,c){return nonEssentialStyles[d]});jQuery(".toolbar-item").addClass("enabled");updateOutputCode();loadWindow("optimise")};var getToolbarClickFunction=function(a){return function(b){if(jQuery("#toolbar-"+a).hasClass("enabled")){loadWindow(a)}}};var updateCheckbox=function(c,b){var a=jQuery(c);a.prop("checked",b);a.trigger("change")};var checkboxOptions={Conservative:{"#use-CSS":false,"#remove-whitespace":false,"#remove-ids":false,"#remove-empty-elements":true,"#combine-paths":false,"#remove-clean-groups":true,"#remove-all-namespaces":false,"#remove-all-default-styles":true,"#remove-all-nonessential-styles":false,},Extreme:{"#use-CSS":true,"#remove-whitespace":true,"#remove-ids":true,"#remove-empty-elements":true,"#combine-paths":true,"#remove-clean-groups":true,"#remove-all-namespaces":true,"#remove-all-default-styles":true,"#remove-all-nonessential-styles":true,},None:{"#use-CSS":false,"#remove-whitespace":false,"#remove-ids":false,"#remove-empty-elements":false,"#combine-paths":false,"#remove-clean-groups":false,"#remove-all-namespaces":false,"#remove-all-default-styles":false,"#remove-all-nonessential-styles":false,}};var selectOptionSet=function(d){var c=checkboxOptions[d];for(var e in c){updateCheckbox(e,c[e])}var a=jQuery("#attr-decimal-places");var b=jQuery("#style-decimal-places");switch(d){case"Conservative":a.val(2);b.val(2);break;case"Extreme":a.val(1);b.val(1);break;default:a.val("unchanged");b.val("unchanged");break}a.trigger("change");b.trigger("change")};jQuery(document).ready(function(){jQuery("#load-button").on("click",function(e){loadSVG(jQuery("#input-svg-code").val())});jQuery("#load-example-button").on("click",function(e){loadSVG(jQuery("#scientist-example").html());jQuery("#example-svg-attribution").show()});var d=["input","optimise","edit","output"];for(var a in d){var c=d[a];jQuery("#toolbar-"+c).on("click",getToolbarClickFunction(c))}jQuery("input:radio[name=optimisation]").change(function(){selectOptionSet(jQuery(this).val())});jQuery("#remove-empty-elements").change(function(){svg_tree.removeEmptyElements=this.checked;updateOutputCode()});jQuery("#remove-clean-groups").change(function(){svg_tree.removeCleanGroups=this.checked;updateOutputCode()});jQuery("#remove-whitespace").change(function(){svg_tree.removeWhitespace=this.checked;updateOutputCode()});jQuery("#attr-decimal-places").change(function(){svg_tree.attrDecimals=getDecimalPlaceFunction(jQuery("#attr-decimal-places").val());updateOutputCode()});jQuery("#style-decimal-places").change(function(){svg_tree.styleDecimals=getDecimalPlaceFunction(jQuery("#style-decimal-places").val());updateOutputCode()});jQuery("#remove-ids").change(function(e){svg_tree.removeIDs=this.checked;updateOutputCode()});jQuery("#use-CSS").change(function(){svg_tree.useCSS=this.checked;updateOutputCode()});jQuery("#combine-paths").change(function(){svg_tree.combinePaths=this.checked;if(svg_tree.combinePaths){svg_tree.root.combinePaths()}updateOutputCode()});var b=jQuery("#input-svg-code").val();if(b){loadSVG(b)}});